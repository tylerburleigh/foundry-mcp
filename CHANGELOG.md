# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- Tool Discovery & Lifecycle (Phase 6):
  - Documentation for tool metadata and discovery (`docs/mcp_best_practices/13-tool-discovery.md`):
    - `ToolDefinition` dataclass with name, description, parameters, category, version, deprecation markers
    - `Parameter` dataclass with type, constraints, examples, and defaults
    - JSON Schema generation from tool definitions via `tool_to_json_schema()`
    - Discovery endpoints: `list_tools()` with category/tag filtering, `get_tool_schema()` for detailed schemas
    - Capability negotiation: `ServerCapabilities` dataclass, `get_capabilities()`, `negotiate_capabilities()`
    - LLM-friendly description patterns with WHEN TO USE/WHEN NOT TO USE guidance
    - Tool category organization for grouping related tools
    - `@deprecated_tool` decorator with replacement and removal version markers
    - Rate limit documentation patterns with `RateLimitInfo` dataclass
    - Anti-patterns guidance (vague descriptions, missing parameters, hidden breaking changes)
- Pagination System (Phase 5):
  - Cursor-based pagination for all list-style tools:
    - Opaque Base64-encoded cursors with `last_id`, `version` fields
    - Default page size: 100, maximum: 1000
    - Standard `meta.pagination` contract: `cursor`, `has_more`, `page_size`, `total_count`
  - Documentation in `docs/mcp_best_practices/06-pagination-streaming.md`:
    - Cursor design patterns vs offset pagination
    - Pagination response format specification
    - Streaming patterns for real-time data
    - Partial result indication
    - Idempotency patterns with idempotency keys
- Resilience Infrastructure (Phase 4):
  - Documentation for timeout and resilience patterns (`docs/mcp_best_practices/12-timeout-resilience.md`):
    - Timeout budgets: Fast (5s), Medium (30s), Slow (120s), Background (600s) with max values
    - `with_timeout` decorator for async functions with configurable error messages
    - Synchronous timeout via `signal.alarm` context manager
    - Exponential backoff `retry_with_backoff()` with jitter and retryable exceptions
    - `@retryable` decorator for automatic retries
    - `CircuitBreaker` dataclass with CLOSED/OPEN/HALF_OPEN states, failure threshold, recovery timeout
    - `with_circuit_breaker` decorator for dependency protection
    - Partial results on timeout pattern for batch operations
    - Resource cleanup with async context managers (`managed_connection`)
    - Health check patterns with `HealthStatus` dataclass and latency tracking
- Enhanced Error Handling (Phase 3):
  - Machine-readable error semantics via `error_response()` helper (`foundry_mcp.core.responses`):
    - `error_code`: SCREAMING_SNAKE_CASE classification (e.g., `VALIDATION_ERROR`, `NOT_FOUND`, `RATE_LIMIT_EXCEEDED`)
    - `error_type`: Category for routing (validation, authorization, not_found, conflict, rate_limit, feature_flag, internal, unavailable)
    - `remediation`: Actionable guidance for resolving errors
    - `details`: Nested structure for field-specific validation context
  - Standard error codes registry:
    - Validation: `VALIDATION_ERROR`, `INVALID_FORMAT`, `MISSING_REQUIRED`
    - Resources: `NOT_FOUND`, `SPEC_NOT_FOUND`, `TASK_NOT_FOUND`, `DUPLICATE_ENTRY`, `CONFLICT`
    - Access: `UNAUTHORIZED`, `FORBIDDEN`, `FEATURE_DISABLED`, `RATE_LIMIT_EXCEEDED`
    - System: `INTERNAL_ERROR`, `UNAVAILABLE`
  - Documentation for error semantics (`docs/codebase_standards/mcp_response_schema.md`):
    - Error type categories with HTTP analogs and retry guidance
    - Common error codes reference table
    - Helper usage examples for validation, not-found, rate-limit, and feature-flag errors
- Feature Flags Infrastructure (Phase 2):
  - Documentation for feature flag patterns (`docs/mcp_best_practices/14-feature-flags.md`):
    - Feature flag lifecycle (EXPERIMENTAL ‚Üí BETA ‚Üí STABLE ‚Üí DEPRECATED)
    - FlagState enum and FeatureFlag dataclass registry contract
    - FeatureFlagService with percentage rollouts, allowlist/blocklist, dependencies
    - Override tooling: `set_override()`, `clear_override()`, `flag_override()` context manager
    - Gradual rollout patterns: percentage-based, allowlist expansion, canary deployment
    - Integration examples with FastMCP tool decorators
    - Testing patterns for both flag states
    - Flag cleanup and audit utilities
    - Anti-patterns guidance (permanent conditionals, nested checks, stale flags)
  - Gating strategy guidance for controlled rollouts:
    - Per-client override support for tenant/client-specific behavior
    - Deterministic bucket assignment using consistent hashing
    - Expiration dates for technical debt prevention
    - Capabilities endpoint integration for client flag discovery
- Security & Input Hygiene (Phase 1):
  - Rate limiting module (`foundry_mcp.core.rate_limit`):
    - `TokenBucketLimiter` - Token bucket algorithm with burst support
    - `RateLimitManager` - Per-tool and per-tenant rate limit management
    - `check_rate_limit` - Convenience function for rate limit checks
    - `RateLimitConfig` / `RateLimitResult` - Configuration and result dataclasses
    - Environment variable configuration (`FOUNDRY_RATE_LIMIT_*`)
    - Manifest-based rate limit configuration support
  - Observability module (`foundry_mcp.core.observability`):
    - `AuditLogger` - Structured security audit logging
    - `audit_log` - Convenience function for audit events
    - `MetricsCollector` - Metrics emission (counter, gauge, timer)
    - `mcp_tool` / `mcp_resource` - Decorators with automatic observability
    - Audit event types: auth_success, auth_failure, rate_limit, resource_access, tool_invocation, permission_denied, config_change
  - Documentation updates:
    - Added recommended `MAX_*` limits table to validation docs
    - Added rate limiting integration examples
    - Added audit logging patterns for validation failures
    - Strengthened cross-references to security guidance

## [0.2.0] - 2025-11-25

### Added
- Validation module (`foundry_mcp.core.validation`):
  - `validate_spec` - Validate spec structure and return structured Diagnostic objects
  - `get_fix_actions` - Generate fix actions from validation diagnostics
  - `apply_fixes` - Apply auto-fixes to spec files with backup support
  - `calculate_stats` - Calculate comprehensive spec statistics
  - Structured diagnostics with code, message, severity, category, location, suggested_fix
  - Auto-fix support for common issues (counts, hierarchy, metadata)
- Journal module (`foundry_mcp.core.journal`):
  - `add_journal_entry` - Add timestamped journal entries with entry types
  - `get_journal_entries` - Retrieve and filter journal entries
  - `mark_blocked` - Mark tasks as blocked with blocker metadata
  - `unblock` - Unblock tasks with resolution tracking
  - `list_blocked_tasks` - List all blocked tasks in a spec
  - `find_unjournaled_tasks` - Find completed tasks needing journal entries
  - Entry types: status_change, deviation, blocker, decision, note
  - Blocker types: dependency, technical, resource, decision
- MCP validation tools (`foundry_mcp.tools.validation`):
  - `foundry_validate_spec` - Validate spec and return structured diagnostics
  - `foundry_fix_spec` - Apply auto-fixes with dry-run support
  - `foundry_spec_stats` - Get comprehensive spec statistics
  - `foundry_validate_and_fix` - Combined validation and fix in one operation
- MCP journal tools (`foundry_mcp.tools.journal`):
  - `foundry_add_journal` - Add journal entries with optional task association
  - `foundry_get_journal` - Retrieve journal entries with filtering
  - `foundry_mark_blocked` - Mark tasks as blocked with metadata
  - `foundry_unblock` - Unblock tasks and track resolution
  - `foundry_list_blocked` - List all blocked tasks
  - `foundry_unjournaled_tasks` - Find tasks needing journal entries
- Rendering module (`foundry_mcp.core.rendering`):
  - `render_spec_to_markdown` - Generate formatted markdown with RenderOptions
  - `render_progress_bar` - Text-based progress visualization
  - `render_task_list` - Flat task listing with status filtering
  - `get_status_icon` - Status to icon mapping (‚è≥üîÑ‚úÖüö´‚ùå)
  - RenderOptions dataclass with mode, include_metadata, include_progress, etc.
- Lifecycle module (`foundry_mcp.core.lifecycle`):
  - `move_spec` - Move specs between folders with transition validation
  - `activate_spec` - Move pending to active
  - `complete_spec` - Move to completed with force option
  - `archive_spec` - Move to archived
  - `get_lifecycle_state` - Get folder, progress, can_complete/can_archive
  - `list_specs_by_folder` - Organized spec listing
  - MoveResult and LifecycleState dataclasses
- MCP rendering tools (`foundry_mcp.tools.rendering`):
  - `foundry_render_spec` - Render spec to markdown with mode options
  - `foundry_render_progress` - ASCII progress bars for spec and phases
  - `foundry_list_tasks` - Flat task list with filtering
- MCP lifecycle tools (`foundry_mcp.tools.lifecycle`):
  - `foundry_move_spec` - Move spec between folders
  - `foundry_activate_spec` - Activate pending spec
  - `foundry_complete_spec` - Mark spec completed
  - `foundry_archive_spec` - Archive spec
  - `foundry_lifecycle_state` - Get lifecycle state and transition eligibility
  - `foundry_list_specs_by_folder` - List specs by folder
- Task operations module (`foundry_mcp.core.task`):
  - `get_next_task` - Find next actionable task based on status and dependencies
  - `check_dependencies` - Analyze blocking and soft dependencies
  - `prepare_task` - Prepare complete context for task implementation
  - `get_previous_sibling` - Get context from previously executed sibling task
  - `get_parent_context` - Get parent task metadata and position
  - `get_phase_context` - Get current phase progress and blockers
  - `get_task_journal_summary` - Get journal entries for a task
  - `is_unblocked` / `is_in_current_phase` - Dependency and phase helpers
- Progress calculation module (`foundry_mcp.core.progress`):
  - `recalculate_progress` - Recursively update task counts
  - `update_parent_status` - Propagate status changes up hierarchy
  - `get_progress_summary` - Get completion percentages and stats
  - `list_phases` - List all phases with progress
  - `get_task_counts_by_status` - Count tasks by status
- MCP task tools (`foundry_mcp.tools.tasks`):
  - `foundry_prepare_task` - Prepare task with full context
  - `foundry_next_task` - Find next actionable task
  - `foundry_task_info` - Get detailed task information
  - `foundry_check_deps` - Check dependency status
  - `foundry_update_status` - Update task status
  - `foundry_complete_task` - Mark task complete with journal
  - `foundry_start_task` - Start working on a task
  - `foundry_progress` - Get spec/phase progress
- Unit tests for task operations (30 tests)
- Documentation query module (`foundry_mcp.core.docs`):
  - `DocsQuery` - Query interface for codebase documentation (codebase.json)
  - `find_class` - Find class by name (exact or substring match)
  - `find_function` - Find function by name (exact or substring match)
  - `find_classes_in_file` / `find_functions_in_file` - File-scoped queries
  - `trace_calls` - Trace call graph (callers, callees, or both) with configurable depth
  - `get_callers` / `get_callees` - Direct caller/callee lookups
  - `impact_analysis` - Analyze change impact with direct/indirect impacts and scores
  - `get_dependencies` / `get_reverse_dependencies` - Module dependency queries
  - `get_metadata` / `get_stats` - Documentation metadata and statistics
  - QueryResult, CallGraphEntry, ImpactResult, DocsQueryResponse dataclasses
  - Auto-discovery of codebase.json in common locations
  - Indexed lookups for fast queries on large codebases
- Testing module (`foundry_mcp.core.testing`):
  - `TestRunner` - Pytest-based test runner with preset support
  - `run_tests` - Run tests with configurable timeout, markers, fail-fast
  - `discover_tests` - Discover tests without running (--collect-only)
  - `get_presets` - Get available test preset configurations
  - Test presets: quick (60s, fail-fast), full (300s), unit, integration, smoke
  - TestResult, TestRunResult, DiscoveredTest, TestDiscoveryResult dataclasses
  - Schema versioning (1.0.0) and execution_id tracking
- MCP documentation tools (`foundry_mcp.tools.docs`):
  - `foundry_find_class` - Find class in documentation
  - `foundry_find_function` - Find function in documentation
  - `foundry_trace_calls` - Trace call graph with direction and depth
  - `foundry_impact_analysis` - Analyze change impact
  - `foundry_get_callers` - Get caller functions
  - `foundry_get_callees` - Get callee functions
  - `foundry_docs_stats` - Get documentation statistics
- MCP testing tools (`foundry_mcp.tools.testing`):
  - `foundry_run_tests` - Full-featured test execution
  - `foundry_discover_tests` - Test discovery
  - `foundry_test_presets` - List available presets
  - `foundry_run_quick_tests` - Quick test preset shortcut
  - `foundry_run_unit_tests` - Unit test preset shortcut
  - All tools include schema_version and execution_id in responses
  - Workspace parameter support for arbitrary repository roots
- MCP resources (`foundry_mcp.resources.specs`):
  - `foundry://specs/` - List all specifications
  - `foundry://specs/{status}/` - List specs by status (active, pending, completed, archived)
  - `foundry://specs/{status}/{spec_id}` - Get specific spec with full hierarchy
  - `foundry://specs/{spec_id}/journal` - Get journal entries for a spec
  - `foundry://templates/` - List available spec templates
  - `foundry://templates/{template_id}` - Get specific template
  - Built-in templates: basic, feature, bugfix
  - Workspace sandbox validation for security
  - Schema versioning (1.0.0) for all responses
- MCP workflow prompts (`foundry_mcp.prompts.workflows`):
  - `start_feature` - Guide new feature setup with template selection
  - `debug_test` - Systematic test debugging workflow
  - `complete_phase` - Phase completion checklist and guidance
  - `review_spec` - Comprehensive spec status review
  - All prompts include available tools and contextual guidance

## [0.1.0] - 2025-01-25

### Added
- Initial project setup with pyproject.toml and hatchling build system
- Core spec operations module (`foundry_mcp.core.spec`):
  - `load_spec` - Load JSON spec files by ID or path
  - `save_spec` - Save specs with atomic writes and automatic backups
  - `find_spec_file` - Locate spec files across status folders
  - `find_specs_directory` - Auto-discover specs directory
  - `list_specs` - List specs with filtering by status
  - `get_node` / `update_node` - Hierarchy node operations
- Package structure following Python best practices
- FastMCP and MCP dependencies for server implementation
