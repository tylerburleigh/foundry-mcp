# CLAUDE Agent Triage Playbook

You are operating inside the `foundry-mcp` repository, which adheres to the MCP Tool Industry Best Practices under [docs/mcp_best_practices](docs/mcp_best_practices). Use this playbook at the start of every session and whenever scope changes.

## 1. Session Auto-Triage

1. **Kickoff scan** – Skim [docs/mcp_best_practices/README.md#L24-L77](docs/mcp_best_practices/README.md#L24-L77) to refresh the document index and review checklist.
2. **Scope-to-doc mapping** – For each planned change, map the work to the decision matrix below and re-open the referenced docs _before_ editing:
   - **Contracts / new tools / helper updates** → Re-read [docs/codebase_standards/mcp_response_schema.md](docs/codebase_standards/mcp_response_schema.md) (canonical response contract), [docs/mcp_best_practices/01-versioned-contracts.md#L9-L127](docs/mcp_best_practices/01-versioned-contracts.md#L9-L127), [docs/mcp_best_practices/02-envelopes-metadata.md#L30-L285](docs/mcp_best_practices/02-envelopes-metadata.md#L30-L285), [docs/mcp_best_practices/03-serialization-helpers.md#L29-L220](docs/mcp_best_practices/03-serialization-helpers.md#L29-L220), [docs/mcp_best_practices/04-validation-input-hygiene.md#L10-L223](docs/mcp_best_practices/04-validation-input-hygiene.md#L10-L223), and [docs/mcp_best_practices/08-security-trust-boundaries.md#L10-L345](docs/mcp_best_practices/08-security-trust-boundaries.md#L10-L345).
   - **Pagination / batching / error semantics** → Re-read [docs/mcp_best_practices/06-pagination-streaming.md#L32-L332](docs/mcp_best_practices/06-pagination-streaming.md#L32-L332) and [docs/mcp_best_practices/07-error-semantics.md#L11-L274](docs/mcp_best_practices/07-error-semantics.md#L11-L274).
   - **Observability / resiliency / timeout work** → Re-read [docs/mcp_best_practices/05-observability-telemetry.md#L12-L333](docs/mcp_best_practices/05-observability-telemetry.md#L12-L333) and [docs/mcp_best_practices/12-timeout-resilience.md#L12-L398](docs/mcp_best_practices/12-timeout-resilience.md#L12-L398).
   - **Feature flags / gated rollouts** → Re-read [docs/mcp_best_practices/14-feature-flags.md#L10-L330](docs/mcp_best_practices/14-feature-flags.md#L10-L330) (plus [docs/mcp_best_practices/12-timeout-resilience.md](docs/mcp_best_practices/12-timeout-resilience.md) for rollback mechanics).
   - **Concurrency / async orchestration / parallelism** → Re-read [docs/mcp_best_practices/15-concurrency-patterns.md#L10-L420](docs/mcp_best_practices/15-concurrency-patterns.md#L10-L420) (and [docs/mcp_best_practices/12-timeout-resilience.md](docs/mcp_best_practices/12-timeout-resilience.md) for cancellation strategy).
   - **LLM ergonomics / tool metadata** → Re-read [docs/mcp_best_practices/11-ai-llm-integration.md#L11-L352](docs/mcp_best_practices/11-ai-llm-integration.md#L11-L352) and [docs/mcp_best_practices/13-tool-discovery.md#L12-L505](docs/mcp_best_practices/13-tool-discovery.md#L12-L505), and consult [docs/codebase_standards/naming-conventions.md](docs/codebase_standards/naming-conventions.md) to keep tool prefixes canonical.
3. **Ambiguity rule** – When uncertainty exists, re-read the full relevant section(s) instead of relying on summaries.
4. **Log references** – Note the consulted sections in your task plan or worklog so reviewers know which guidance informed the change.

## 2. Development & Testing Flow

- **Specs + docs + tests together** – Any contract-impacting change MUST update specs ([docs/mcp_best_practices/09-spec-driven-development.md#L11-L214](docs/mcp_best_practices/09-spec-driven-development.md#L11-L214)), documentation, and fixtures/tests ([docs/mcp_best_practices/10-testing-fixtures.md#L10-L335](docs/mcp_best_practices/10-testing-fixtures.md#L10-L335)) in the same change set.
- **Testing guidance** – Before adjusting or regenerating fixtures/tests, reopen [docs/mcp_best_practices/10-testing-fixtures.md](docs/mcp_best_practices/10-testing-fixtures.md) to confirm freshness checks, schema alignment, and helper coverage expectations.
- **Running tests** – For test commands, presets, debugging strategies, and test suite structure, see [docs/guides/testing.md](docs/guides/testing.md).
- **Security-sensitive work** – If touching trust boundaries, re-read [docs/mcp_best_practices/04-validation-input-hygiene.md](docs/mcp_best_practices/04-validation-input-hygiene.md), [docs/mcp_best_practices/07-error-semantics.md](docs/mcp_best_practices/07-error-semantics.md), [docs/mcp_best_practices/08-security-trust-boundaries.md](docs/mcp_best_practices/08-security-trust-boundaries.md), and [docs/mcp_best_practices/11-ai-llm-integration.md](docs/mcp_best_practices/11-ai-llm-integration.md) in full and document the applied mitigations in commit/PR notes.

## 3. Code Review Checklist Alignment

- Prior to submitting or reviewing a PR, walk through the checklist in [docs/mcp_best_practices/README.md#L64-L70](docs/mcp_best_practices/README.md#L64-L70).
- Confirm every modified surface adheres to envelopes/helpers ([docs/mcp_best_practices/02-envelopes-metadata.md](docs/mcp_best_practices/02-envelopes-metadata.md), [docs/mcp_best_practices/03-serialization-helpers.md](docs/mcp_best_practices/03-serialization-helpers.md)), validation/sanitization ([docs/mcp_best_practices/04-validation-input-hygiene.md](docs/mcp_best_practices/04-validation-input-hygiene.md), [docs/mcp_best_practices/08-security-trust-boundaries.md](docs/mcp_best_practices/08-security-trust-boundaries.md)), pagination/error semantics ([docs/mcp_best_practices/06-pagination-streaming.md](docs/mcp_best_practices/06-pagination-streaming.md), [docs/mcp_best_practices/07-error-semantics.md](docs/mcp_best_practices/07-error-semantics.md)), observability/resilience ([docs/mcp_best_practices/05-observability-telemetry.md](docs/mcp_best_practices/05-observability-telemetry.md), [docs/mcp_best_practices/12-timeout-resilience.md](docs/mcp_best_practices/12-timeout-resilience.md)), feature-flag lifecycle controls ([docs/mcp_best_practices/14-feature-flags.md](docs/mcp_best_practices/14-feature-flags.md)), concurrency/cancellation guidance ([docs/mcp_best_practices/15-concurrency-patterns.md](docs/mcp_best_practices/15-concurrency-patterns.md)), and testing/spec sync ([docs/mcp_best_practices/09-spec-driven-development.md](docs/mcp_best_practices/09-spec-driven-development.md), [docs/mcp_best_practices/10-testing-fixtures.md](docs/mcp_best_practices/10-testing-fixtures.md)).
- Reference the consulted sections explicitly in the PR description or review comments for traceability.

## 4. Operational Reminders

- Keep responses concise and structured for LLM consumption per [docs/mcp_best_practices/11-ai-llm-integration.md](docs/mcp_best_practices/11-ai-llm-integration.md); use progressive disclosure and tool-chaining-friendly outputs.
- When documenting or exposing tools, update discovery metadata per [docs/mcp_best_practices/13-tool-discovery.md](docs/mcp_best_practices/13-tool-discovery.md) (usage examples, tags, rate limits, capability negotiation).
- Default to schema-tagged envelopes via the helpers in `src/foundry_mcp/core/responses.py`; never hand-roll response objects. See [docs/codebase_standards/mcp_response_schema.md](docs/codebase_standards/mcp_response_schema.md) for the full response contract and usage examples.
