{
  "spec_id": "provider-rate-limit-resilience-2026-01-27-001",
  "title": "provider-rate-limit-resilience",
  "generated": "2026-01-27T17:15:04.795128Z",
  "last_updated": "2026-01-27T17:17:25.181439Z",
  "metadata": {
    "description": "",
    "mission": "Add robust rate limit resilience to all search providers by implementing jitter, per-provider rate limiting, and circuit breakers while eliminating code duplication",
    "objectives": [],
    "complexity": "low",
    "estimated_hours": 0,
    "assumptions": [
      "Existing resilience.py CircuitBreaker and rate_limit.py TokenBucketLimiter are stable and tested",
      "Provider rate limits (1 req/s default) are appropriate starting points",
      "Semantic Scholar limits require less than 1 req/s across all endpoints; defaults should use 0.9 RPS",
      "Deep research can tolerate slightly slower provider responses due to rate limiting",
      "Per-process rate limiting is sufficient (no distributed coordination needed)"
    ],
    "owner": "",
    "category": "implementation",
    "template": "empty"
  },
  "progress_percentage": 0,
  "status": "pending",
  "current_phase": null,
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "provider-rate-limit-resilience",
      "status": "pending",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4",
        "phase-5"
      ],
      "total_tasks": 30,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "Create Shared Provider Resilience Module",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3",
        "task-1-4",
        "task-1-5",
        "task-1-6",
        "verify-1-1"
      ],
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Create centralized resilience utilities that compose existing primitives for search providers"
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Create resilience.py with core dataclasses",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create ProviderResilienceConfig dataclass with per-provider defaults and ErrorClassification dataclass for error taxonomy",
        "file_path": "src/foundry_mcp/core/research/providers/resilience.py",
        "acceptance_criteria": [
          "ProviderResilienceConfig includes requests_per_second, burst_limit, max_retries, base_delay, max_delay, jitter, circuit_failure_threshold, circuit_recovery_timeout",
          "ErrorClassification includes retryable, trips_breaker, backoff_seconds, error_type fields",
          "PROVIDER_CONFIGS dict with tuned defaults for tavily, google, perplexity, semantic_scholar, tavily_extract",
          "Semantic Scholar default requests_per_second is 0.9 RPS across all endpoints"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "Implement ProviderResilienceManager singleton",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create singleton manager with per-provider rate limiters and circuit breakers, plus state inspection API",
        "file_path": "src/foundry_mcp/core/research/providers/resilience.py",
        "acceptance_criteria": [
          "Module-level singleton with lazy initialization",
          "get_resilience_manager() accessor function",
          "reset_resilience_manager_for_testing() for test isolation",
          "get_breaker_state(), is_provider_available(), get_provider_status() inspection methods",
          "Uses asyncio.Lock for thread-safe async access"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "Implement async_retry_with_backoff with jitter",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create async version of retry_with_backoff with injectable RNG/clock for deterministic testing",
        "file_path": "src/foundry_mcp/core/research/providers/resilience.py",
        "acceptance_criteria": [
          "Jitter enabled by default (50-150% of base delay)",
          "Injectable random.Random instance for seeded testing",
          "Injectable clock/sleep function for time control",
          "Exponential backoff with configurable base and max delay",
          "Retryable exceptions filter support"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-4": {
      "type": "task",
      "title": "Implement execute_with_resilience unified executor",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create unified executor combining circuit breaker check, rate limit acquisition, timeout, retry, and recording",
        "file_path": "src/foundry_mcp/core/research/providers/resilience.py",
        "acceptance_criteria": [
          "Checks circuit breaker first (fail fast if OPEN)",
          "Acquires rate limiter token (waits up to max_wait_seconds)",
          "Applies time budget accounting",
          "Retries with jitter on transient failures",
          "Records success/failure to circuit breaker",
          "Raises TimeBudgetExceededError when budget exhausted"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-5": {
      "type": "task",
      "title": "Integrate with audit_log for observability",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add structured audit logging for all resilience events using defined schema",
        "file_path": "src/foundry_mcp/core/research/providers/resilience.py",
        "acceptance_criteria": [
          "rate_limit_wait events logged with wait_ms, provider",
          "retry_attempt events logged with attempt, max_attempts, error_type",
          "circuit_state_change events logged with old/new state",
          "budget_exceeded events logged with elapsed time, attempts",
          "All events include correlation_id when available"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-6": {
      "type": "task",
      "title": "Create unit tests for resilience module",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create comprehensive unit tests for all new resilience utilities",
        "file_path": "tests/core/research/providers/test_resilience.py",
        "acceptance_criteria": [
          "Jitter tests are deterministic (seeded RNG)",
          "Manager creates isolated limiters/breakers per provider",
          "Test reset clears all state correctly",
          "Circuit breaker state transitions tested",
          "Rate limiter token acquisition tested",
          "Time budget enforcement tested"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Phase 1 Fidelity Review",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run foundry-review to verify implementation matches spec",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Refactor Tavily Provider (Pilot)",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-2-1",
        "task-2-2",
        "task-2-3",
        "task-2-4",
        "task-2-5",
        "verify-2-1"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Refactor Tavily as pilot to validate the shared resilience approach before rolling out to other providers"
      },
      "dependencies": {
        "blocks": [
          "phase-3"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "Add feature flag for enhanced resilience",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add FOUNDRY_ENHANCED_RESILIENCE environment variable check with per-provider override support",
        "file_path": "src/foundry_mcp/core/research/providers/resilience.py",
        "acceptance_criteria": [
          "FOUNDRY_ENHANCED_RESILIENCE defaults to true",
          "Per-provider override via FOUNDRY_ENHANCED_RESILIENCE_TAVILY etc",
          "is_enhanced_resilience_enabled(provider) helper function"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "Implement classify_error for Tavily",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add classify_error() method to TavilySearchProvider for Tavily-specific error classification",
        "file_path": "src/foundry_mcp/core/research/providers/tavily.py",
        "acceptance_criteria": [
          "401 -> AuthenticationError, not retryable, no breaker trip",
          "429 -> RateLimitError, retryable, no breaker trip, uses Retry-After",
          "5xx -> retryable, trips breaker",
          "400 -> not retryable, no breaker trip",
          "Timeout/connection errors -> retryable, trips breaker"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "Replace _execute_with_retry in Tavily",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Replace existing _execute_with_retry method with call to execute_with_resilience, gated by feature flag",
        "file_path": "src/foundry_mcp/core/research/providers/tavily.py",
        "acceptance_criteria": [
          "Feature flag check at start of method",
          "If disabled, use legacy retry logic",
          "If enabled, call execute_with_resilience with Tavily config",
          "Preserve same exception types raised (RateLimitError, AuthenticationError, SearchProviderError)",
          "Remove ~90 lines of duplicate retry code when flag enabled"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-4": {
      "type": "task",
      "title": "Add resilience_config property to Tavily",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add resilience_config property returning Tavily-specific ProviderResilienceConfig",
        "file_path": "src/foundry_mcp/core/research/providers/tavily.py",
        "acceptance_criteria": [
          "Returns ProviderResilienceConfig for tavily",
          "Uses provider defaults from PROVIDER_CONFIGS",
          "Can be overridden via constructor parameter"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-5": {
      "type": "task",
      "title": "Update Tavily tests for new resilience",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update existing Tavily tests to work with new implementation, test both flag states",
        "file_path": "tests/core/research/providers/test_tavily.py",
        "acceptance_criteria": [
          "All existing tests pass with flag enabled",
          "All existing tests pass with flag disabled",
          "New test for circuit breaker integration",
          "New test for rate limiter integration",
          "Tests use reset_resilience_manager_for_testing() for isolation"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Phase 2 Fidelity Review",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run foundry-review to verify Tavily pilot implementation",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Refactor Remaining Providers",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-3-1",
        "task-3-2",
        "task-3-3",
        "task-3-4",
        "task-3-5",
        "verify-3-1"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Apply the validated pattern to all remaining search providers (Google, Perplexity, Semantic Scholar, Tavily Extract)"
      },
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-2"
        ],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "Refactor Google provider with 403 quota handling",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Replace _execute_with_retry, add classify_error with special 403 quota detection, add resilience_config",
        "file_path": "src/foundry_mcp/core/research/providers/google.py",
        "acceptance_criteria": [
          "classify_error detects 403 with 'quota' or 'limit' in error as retryable",
          "403 without quota keywords treated as AuthenticationError",
          "Replace _execute_with_retry (~95 lines) with execute_with_resilience call",
          "resilience_config property returns Google-specific config",
          "All existing Google tests pass"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "Refactor Perplexity provider",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Replace _execute_with_retry, add classify_error, add resilience_config",
        "file_path": "src/foundry_mcp/core/research/providers/perplexity.py",
        "acceptance_criteria": [
          "classify_error follows standard error taxonomy",
          "Replace _execute_with_retry (~90 lines) with execute_with_resilience call",
          "Bearer token auth preserved",
          "resilience_config property returns Perplexity-specific config",
          "All existing Perplexity tests pass"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "Refactor Semantic Scholar provider",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Replace _execute_with_retry, add classify_error, add resilience_config",
        "file_path": "src/foundry_mcp/core/research/providers/semantic_scholar.py",
        "acceptance_criteria": [
          "classify_error follows standard error taxonomy",
          "Replace _execute_with_retry (~90 lines) with execute_with_resilience call",
          "Optional API key handling preserved",
          "resilience_config property returns Semantic Scholar-specific config (lower burst due to strict rate limits)",
          "All existing Semantic Scholar tests pass"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-4": {
      "type": "task",
      "title": "Refactor Tavily Extract provider",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Replace _execute_with_retry, add classify_error, add resilience_config",
        "file_path": "src/foundry_mcp/core/research/providers/tavily_extract.py",
        "acceptance_criteria": [
          "classify_error follows standard error taxonomy",
          "Replace _execute_with_retry (~90 lines) with execute_with_resilience call",
          "SSRF protection preserved",
          "resilience_config property returns Tavily Extract-specific config",
          "All existing Tavily Extract tests pass"
        ],
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-5": {
      "type": "task",
      "title": "Add classify_error hook to SearchProvider base",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add default classify_error method to SearchProvider base class",
        "file_path": "src/foundry_mcp/core/research/providers/base.py",
        "acceptance_criteria": [
          "Default implementation uses error taxonomy table",
          "Method signature: classify_error(response, exception) -> ErrorClassification",
          "Providers can override for custom behavior",
          "Backward compatible (existing providers work without override)"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Phase 3 Fidelity Review",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run foundry-review to verify all providers refactored correctly",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Enhance Deep Research Orchestration",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-4-1",
        "task-4-2",
        "task-4-3",
        "task-4-4",
        "verify-4-1"
      ],
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Make deep research gathering phase aware of circuit breaker states for smarter provider selection"
      },
      "dependencies": {
        "blocks": [
          "phase-5"
        ],
        "blocked_by": [
          "phase-3"
        ],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "Add circuit breaker filtering to provider selection",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update gathering phase to use is_provider_available() to filter providers before selection",
        "file_path": "src/foundry_mcp/core/research/workflows/deep_research.py",
        "acceptance_criteria": [
          "Import ProviderResilienceManager",
          "Filter out providers with OPEN circuit breakers",
          "Allow HALF_OPEN providers (enables recovery probes)",
          "Filtering happens before provider iteration loop (lines ~3243)"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Add audit event for all providers unavailable",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Log structured audit event when all providers have open circuit breakers",
        "file_path": "src/foundry_mcp/core/research/workflows/deep_research.py",
        "acceptance_criteria": [
          "Log 'all_providers_circuit_open' event at error level",
          "Include circuit breaker states for all configured providers",
          "Event follows observability schema (provider, event_type, breaker_state)",
          "Gathering gracefully fails with informative error message"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "Include circuit breaker states in gathering metadata",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add circuit breaker states to gathering result metadata for observability",
        "file_path": "src/foundry_mcp/core/research/workflows/deep_research.py",
        "acceptance_criteria": [
          "Gathering result includes 'circuit_breaker_states' dict",
          "States captured at start and end of gathering phase",
          "Each provider shows CLOSED/OPEN/HALF_OPEN state",
          "Metadata available in phase completion audit event"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-4": {
      "type": "task",
      "title": "Handle circuit breaker opening mid-gathering",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add graceful degradation when circuit breaker opens during gathering execution",
        "file_path": "src/foundry_mcp/core/research/workflows/deep_research.py",
        "acceptance_criteria": [
          "If provider trips breaker mid-gathering, skip for remaining sub-queries",
          "Log warning when provider becomes unavailable during execution",
          "Continue with remaining available providers",
          "Don't fail entire gathering if some providers become unavailable"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-1": {
      "type": "verify",
      "title": "Phase 4 Fidelity Review",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run foundry-review to verify deep research integration",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-5": {
      "type": "phase",
      "title": "Testing, Documentation, and Rollout",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-5-1",
        "task-5-2",
        "task-5-3",
        "task-5-4",
        "task-5-5",
        "verify-5-1"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Ensure comprehensive test coverage, documentation, and safe rollout with feature flag verification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-4"
        ],
        "depends": []
      }
    },
    "task-5-1": {
      "type": "task",
      "title": "Add integration tests for resilience behaviors",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add comprehensive integration tests covering all resilience scenarios",
        "file_path": "tests/core/research/providers/test_resilience.py",
        "acceptance_criteria": [
          "Deterministic jitter tests using seeded RNG",
          "Circuit breaker threshold and state transition tests",
          "Rate limiter token acquisition and wait tests",
          "Time budget enforcement and cancellation tests",
          "Full stack integration test with mocked HTTP responses"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-2": {
      "type": "task",
      "title": "Add deep research failover integration tests",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add integration tests for deep research provider failover with circuit breakers",
        "file_path": "tests/core/research/workflows/test_deep_research.py",
        "acceptance_criteria": [
          "Test skipping OPEN providers",
          "Test allowing HALF_OPEN recovery probes",
          "Test all_providers_circuit_open scenario",
          "Test graceful degradation when provider trips mid-gathering",
          "Tests use reset_resilience_manager_for_testing() for isolation"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-3": {
      "type": "task",
      "title": "Update provider docstrings with resilience notes",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update SearchProvider and all provider docstrings to document resilience behavior",
        "file_path": "src/foundry_mcp/core/research/providers/base.py",
        "acceptance_criteria": [
          "SearchProvider docstring mentions classify_error hook",
          "Each provider docstring notes specific error handling",
          "Document rate limit and circuit breaker behavior",
          "Note feature flag for enhanced resilience"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-4": {
      "type": "task",
      "title": "Add CHANGELOG entry",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Document new resilience features in CHANGELOG",
        "file_path": "CHANGELOG.md",
        "acceptance_criteria": [
          "Entry under appropriate version section",
          "Documents jitter, rate limiting, circuit breakers",
          "Notes feature flag for rollback",
          "Links to relevant documentation"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-5": {
      "type": "task",
      "title": "Verify feature flag rollback",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add tests verifying feature flag correctly toggles between legacy and enhanced resilience",
        "file_path": "tests/core/research/providers/test_resilience.py",
        "acceptance_criteria": [
          "Test FOUNDRY_ENHANCED_RESILIENCE=false uses legacy path",
          "Test FOUNDRY_ENHANCED_RESILIENCE=true uses new path",
          "Test per-provider override works (FOUNDRY_ENHANCED_RESILIENCE_TAVILY)",
          "Both paths produce same external behavior for normal cases"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-5-1": {
      "type": "verify",
      "title": "Final Spec Fidelity Review",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run foundry-review for full spec to verify all success criteria met",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    }
  },
  "journal": []
}
