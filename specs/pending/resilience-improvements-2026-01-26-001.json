{
  "spec_id": "resilience-improvements-2026-01-26-001",
  "title": "resilience-improvements",
  "generated": "2026-01-26T12:57:11.734874Z",
  "last_updated": "2026-01-26T13:04:16.446197Z",
  "metadata": {
    "description": "",
    "mission": "Add robust cancellation, timeout, and progress reporting to background tasks and provider calls.",
    "objectives": [],
    "complexity": "low",
    "estimated_hours": 0,
    "assumptions": [
      "Single-process deployment assumed; in-memory TaskRegistry does not support multi-worker deployments",
      "Provider calls are async (httpx async client); executor isolation only applies to blocking operations if any are identified",
      "Two-phase cancellation: cooperative first (5s grace period), then forced via asyncio.Task.cancel()",
      "Timeout watchdog is active (background polling every 10s), not passive (checked only on client poll)",
      "Retry logic is out of scope; ProviderTimeoutError means the sub-query is skipped, not retried"
    ],
    "owner": "",
    "category": "implementation",
    "template": "empty"
  },
  "progress_percentage": 0,
  "status": "pending",
  "current_phase": null,
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "resilience-improvements",
      "status": "pending",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4",
        "phase-5",
        "phase-6",
        "phase-7",
        "phase-8"
      ],
      "total_tasks": 104,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "Task Registry & Cancellation",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3",
        "task-1-4",
        "task-1-5",
        "task-1-6",
        "task-1-7",
        "task-1-8",
        "task-1-9",
        "task-1-10",
        "task-1-11",
        "verify-1-1",
        "verify-1-2",
        "verify-1-3",
        "verify-1-4",
        "verify-1-5",
        "verify-1-6"
      ],
      "total_tasks": 17,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Enable graceful cancellation of in-flight background tasks with proper state persistence.",
        "description": "Establish task tracking infrastructure and enable graceful cancellation with proper state persistence."
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Create TaskRegistry singleton",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create TaskRegistry singleton with Dict[str, BackgroundTask] storage",
        "file_path": "src/foundry_mcp/core/task_registry.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "Add asyncio.Lock for registry",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add asyncio.Lock for thread-safe registry operations",
        "file_path": "src/foundry_mcp/core/task_registry.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "Implement registry methods",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement register(task), get(task_id), remove(task_id) methods",
        "file_path": "src/foundry_mcp/core/task_registry.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-4": {
      "type": "task",
      "title": "Add registry cleanup task",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add cleanup task: remove tasks 5 minutes after terminal state",
        "file_path": "src/foundry_mcp/core/task_registry.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-5": {
      "type": "task",
      "title": "Add cancellation_event to BackgroundTask",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add cancellation_event: asyncio.Event to BackgroundTask for cooperative cancellation",
        "file_path": "src/foundry_mcp/core/background_task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-6": {
      "type": "task",
      "title": "Implement two-phase cancel()",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement two-phase BackgroundTask.cancel(): set event, wait 5s, then force cancel",
        "file_path": "src/foundry_mcp/core/background_task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-7": {
      "type": "task",
      "title": "Add cancellation checks at iteration boundaries",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add cancellation checks at iteration boundaries in _execute_phase() (before each sub-query/provider batch)",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-8": {
      "type": "task",
      "title": "Add cancellation check before provider calls",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add cancellation check before each provider call in the workflow",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-9": {
      "type": "task",
      "title": "Handle CancelledError at workflow top-level",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Catch CancelledError at workflow top-level, persist cancelling -> cleanup -> cancelled state transitions",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-10": {
      "type": "task",
      "title": "Add try/finally for resource cleanup",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add try/finally blocks for resource cleanup (connections, temp files) on cancellation",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-11": {
      "type": "task",
      "title": "Implement partial result policy",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement partial result policy: discard incomplete iteration results, persist only completed iterations",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Test: registry concurrency",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Unit test verifies task registry add/get/remove with concurrency",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "Test: cancellation state transitions",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Unit test cancels mid-phase, verify state transitions: running -> cancelling -> cancelled",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-3": {
      "type": "verify",
      "title": "Test: partial results discarded",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Unit test verifies partial results from interrupted iteration are discarded",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-4": {
      "type": "verify",
      "title": "Test: cooperative cancellation timing",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Integration test confirms cooperative cancellation completes within 5s (mock provider)",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-5": {
      "type": "verify",
      "title": "Test: forced cancellation timing",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Integration test confirms forced cancellation completes within 10s (mock blocking provider)",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Timeout Watchdog",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-2-1",
        "task-2-2",
        "task-2-3",
        "task-2-4",
        "task-2-5",
        "task-2-6",
        "task-2-7",
        "task-2-8",
        "task-2-9",
        "task-2-10",
        "verify-2-1",
        "verify-2-2",
        "verify-2-3",
        "verify-2-4",
        "verify-2-5"
      ],
      "total_tasks": 15,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Detect and handle timed-out background tasks with proper metadata persistence and audit events.",
        "description": "Actively detect and handle timed-out background tasks with proper state persistence and audit events."
      },
      "dependencies": {
        "blocks": [
          "phase-3"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "Create TimeoutWatchdog class",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create TimeoutWatchdog class with background asyncio task",
        "file_path": "src/foundry_mcp/core/timeout_watchdog.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "Implement polling loop",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement polling loop: check all running tasks every 10 seconds",
        "file_path": "src/foundry_mcp/core/timeout_watchdog.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "Add is_timed_out property",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add is_timed_out property to BackgroundTask: True if elapsed > task_timeout",
        "file_path": "src/foundry_mcp/core/background_task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-4": {
      "type": "task",
      "title": "Add is_stale property",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add is_stale property: True if no heartbeat for >90 seconds while status is running",
        "file_path": "src/foundry_mcp/core/background_task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-5": {
      "type": "task",
      "title": "Implement timeout cancellation trigger",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "On timeout detected: initiate two-phase cancellation, terminal state timed_out",
        "file_path": "src/foundry_mcp/core/timeout_watchdog.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-6": {
      "type": "task",
      "title": "Persist timeout metadata",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Persist timeout metadata (timed_out_at, elapsed_seconds) to state",
        "file_path": "src/foundry_mcp/core/background_task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-7": {
      "type": "task",
      "title": "Emit task.timeout audit event",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Emit task.timeout audit event with task_id, elapsed time, configured timeout",
        "file_path": "src/foundry_mcp/core/timeout_watchdog.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-8": {
      "type": "task",
      "title": "Add staleness detection",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add staleness detection: mark as stale in status (informational, not terminal)",
        "file_path": "src/foundry_mcp/core/timeout_watchdog.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-9": {
      "type": "task",
      "title": "Implement watchdog lifecycle",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Watchdog lifecycle: start on app startup, cancel on shutdown",
        "file_path": "src/foundry_mcp/core/timeout_watchdog.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-10": {
      "type": "task",
      "title": "Update status response with timeout metadata",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Ensure status response includes timeout/staleness metadata when applicable",
        "file_path": "src/foundry_mcp/routers/research.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Test: is_timed_out detection",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Unit test with short timeout verifies is_timed_out=True and state transition",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "Test: staleness detection",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Unit test verifies staleness detection when heartbeat stops for 90s",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-3": {
      "type": "verify",
      "title": "Test: watchdog polling interval",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Unit test verifies watchdog polling interval (mock time)",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-4": {
      "type": "verify",
      "title": "Test: status response timeout metadata",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify status response includes timeout metadata",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Provider Timeout Enforcement",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-3-1",
        "task-3-2",
        "task-3-3",
        "task-3-4",
        "task-3-5",
        "task-3-6",
        "task-3-7",
        "task-3-8",
        "verify-3-1",
        "verify-3-2",
        "verify-3-3",
        "verify-3-4"
      ],
      "total_tasks": 12,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Ensure all providers honor request.timeout and fail fast with ProviderTimeoutError.",
        "description": "Ensure all providers honor request timeouts and fail fast with appropriate errors."
      },
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-2"
        ],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "Add ProviderTimeoutError exception",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add ProviderTimeoutError(ProviderError) to core/exceptions.py with fields: provider, elapsed, timeout",
        "file_path": "src/foundry_mcp/core/exceptions.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "Review and update anthropic.py",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Review anthropic.py generate(): verify httpx client timeout, add asyncio.wait_for() wrapper, ensure connection cleanup per enforcement pattern",
        "file_path": "src/foundry_mcp/providers/anthropic.py",
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "Review and update openai.py",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Review and update openai.py with timeout enforcement pattern",
        "file_path": "src/foundry_mcp/providers/openai.py",
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-4": {
      "type": "task",
      "title": "Review and update ollama.py",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Review and update ollama.py with timeout enforcement pattern",
        "file_path": "src/foundry_mcp/providers/ollama.py",
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-5": {
      "type": "task",
      "title": "Review and update google.py",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Review and update google.py with timeout enforcement pattern",
        "file_path": "src/foundry_mcp/providers/google.py",
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-6": {
      "type": "task",
      "title": "Review and update tavily.py",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Review and update tavily.py with timeout enforcement pattern",
        "file_path": "src/foundry_mcp/providers/tavily.py",
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-7": {
      "type": "task",
      "title": "Add workflow-level timeout handling",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add workflow-level handling: catch ProviderTimeoutError at sub-query level, log, mark failed, continue",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-8": {
      "type": "task",
      "title": "Include failed sub-queries in result",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Include failed sub-queries with reasons in final result",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Test: provider timeout raises error",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Per-provider unit test with mock 2s delay, 1s timeout, verify ProviderTimeoutError raised",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "Test: timeout error contains metadata",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify timeout error includes provider name, elapsed time, configured timeout",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-3": {
      "type": "verify",
      "title": "Test: workflow continues after timeout",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify workflow continues after provider timeout, final result lists failed sub-queries",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Progress Heartbeats",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-4-1",
        "task-4-2",
        "task-4-3",
        "task-4-4",
        "task-4-5",
        "task-4-6",
        "task-4-7",
        "task-4-8",
        "verify-4-1",
        "verify-4-2",
        "verify-4-3",
        "verify-4-4"
      ],
      "total_tasks": 12,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Emit progress heartbeats and audit events for long-running tasks.",
        "description": "Provide visibility into long-running task progress through audit events and persisted state."
      },
      "dependencies": {
        "blocks": [
          "phase-5"
        ],
        "blocked_by": [
          "phase-3"
        ],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "Emit phase.started audit event",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Emit phase.started audit event: {phase_name, iteration, task_id, timestamp}",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Emit phase.completed audit event",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Emit phase.completed audit event: {phase_name, iteration, task_id, duration_ms, timestamp}",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "Emit llm.call.started audit event",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Emit llm.call.started audit event: {provider, task_id, timestamp}",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-4": {
      "type": "task",
      "title": "Emit llm.call.completed audit event",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Emit llm.call.completed audit event: {provider, task_id, duration_ms, status, timestamp}",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-5": {
      "type": "task",
      "title": "Update heartbeat before provider calls",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update last_heartbeat_at BEFORE each provider call (not after)",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-6": {
      "type": "task",
      "title": "Persist interim state",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Persist interim state: current_phase, current_iteration, last_heartbeat_at",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-7": {
      "type": "task",
      "title": "Add phase duration metric",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add metric foundry_mcp_research_phase_duration_seconds (histogram, labels: phase_name, status)",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-8": {
      "type": "task",
      "title": "Add LLM call duration metric",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add metric foundry_mcp_research_llm_call_duration_seconds (histogram, labels: provider, status)",
        "file_path": "src/foundry_mcp/workflows/deep_research_workflow.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-1": {
      "type": "verify",
      "title": "Test: status shows progress",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify status response shows current_phase and last_heartbeat_at during execution",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "Test: audit events structure",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify audit log contains phase and LLM call events with correct structure",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-3": {
      "type": "verify",
      "title": "Test: heartbeat timing",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify heartbeat updated before (not after) provider call",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-5": {
      "type": "phase",
      "title": "Default Timeout Configuration",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-5-1",
        "task-5-2",
        "task-5-3",
        "task-5-4",
        "task-5-5",
        "task-5-6",
        "task-5-7",
        "verify-5-1",
        "verify-5-2",
        "verify-5-3",
        "verify-5-4"
      ],
      "total_tasks": 11,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Apply default timeouts from config with precedence: explicit param > config > hardcoded fallback.",
        "description": "Provide sensible default timeouts via configuration with clear precedence rules."
      },
      "dependencies": {
        "blocks": [
          "phase-6"
        ],
        "blocked_by": [
          "phase-4"
        ],
        "depends": []
      }
    },
    "task-5-1": {
      "type": "task",
      "title": "Add timeout constant",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add DEFAULT_DEEP_RESEARCH_TIMEOUT = 600 constant to core/constants.py",
        "file_path": "src/foundry_mcp/core/constants.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-2": {
      "type": "task",
      "title": "Add config schema field",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add research.deep_research_timeout to config schema (default: 600)",
        "file_path": "src/foundry_mcp/core/config.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-3": {
      "type": "task",
      "title": "Update config model",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update config model to include the new field",
        "file_path": "src/foundry_mcp/core/config.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-4": {
      "type": "task",
      "title": "Verify backward compatibility",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify config loader handles missing field gracefully (backward compatible)",
        "file_path": "src/foundry_mcp/core/config.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-5": {
      "type": "task",
      "title": "Apply default in action handler",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Apply default in action handler when task_timeout not explicitly set",
        "file_path": "src/foundry_mcp/routers/research.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-6": {
      "type": "task",
      "title": "Document precedence in code",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Document precedence in code comments: explicit param > config > hardcoded fallback",
        "file_path": "src/foundry_mcp/routers/research.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-7": {
      "type": "task",
      "title": "Expose effective timeout in metadata",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Expose effective timeout in tool metadata response",
        "file_path": "src/foundry_mcp/routers/research.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-5-1": {
      "type": "verify",
      "title": "Test: config default applies",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Config default applies when param omitted",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-5-2": {
      "type": "verify",
      "title": "Test: explicit param overrides",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Explicit param overrides config",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-5-3": {
      "type": "verify",
      "title": "Test: hardcoded fallback",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Hardcoded fallback applies when config section missing",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-6": {
      "type": "phase",
      "title": "Executor Isolation",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-6-1",
        "task-6-2",
        "task-6-3",
        "task-6-4",
        "task-6-5",
        "task-6-6",
        "task-6-7",
        "task-6-8",
        "task-6-9",
        "task-6-10",
        "task-6-11",
        "task-6-12",
        "task-6-13",
        "task-6-14",
        "verify-6-1",
        "verify-6-2",
        "verify-6-3",
        "verify-6-4"
      ],
      "total_tasks": 18,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Isolate blocking provider operations in dedicated executor to prevent starvation.",
        "description": "Isolate blocking provider operations in a dedicated executor to prevent starvation. Conditional on audit identifying blocking operations."
      },
      "dependencies": {
        "blocks": [
          "phase-7"
        ],
        "blocked_by": [
          "phase-5"
        ],
        "depends": []
      }
    },
    "task-6-1": {
      "type": "task",
      "title": "Audit blocking operations",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Audit: Identify blocking operations in all providers (sync file I/O, CPU-bound parsing, etc.)",
        "task_category": "investigation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-2": {
      "type": "task",
      "title": "Document audit findings",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Document which operations require executor isolation (if any); if none, mark phase as skipped",
        "task_category": "investigation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-3": {
      "type": "task",
      "title": "Create ProviderExecutor class",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create executor.py module with ProviderExecutor class wrapping ThreadPoolExecutor",
        "file_path": "src/foundry_mcp/core/executor.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-4": {
      "type": "task",
      "title": "Add executor pool size config",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add config: providers.executor_pool_size (default: 4)",
        "file_path": "src/foundry_mcp/core/config.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-5": {
      "type": "task",
      "title": "Add executor queue limit config",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add config: providers.executor_queue_limit (default: 16)",
        "file_path": "src/foundry_mcp/core/config.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-6": {
      "type": "task",
      "title": "Tie executor to app lifecycle",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Tie executor lifecycle to application startup/shutdown hooks",
        "file_path": "src/foundry_mcp/core/executor.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-7": {
      "type": "task",
      "title": "Implement graceful shutdown",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement graceful shutdown with 30s drain timeout",
        "file_path": "src/foundry_mcp/core/executor.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-8": {
      "type": "task",
      "title": "Route blocking operations through executor",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Route identified blocking operations through dedicated executor",
        "file_path": "src/foundry_mcp/providers/provider_manager.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-9": {
      "type": "task",
      "title": "Implement fallback to shared executor",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement fallback to shared executor when queue limit reached",
        "file_path": "src/foundry_mcp/core/executor.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-10": {
      "type": "task",
      "title": "Add ExecutorExhaustedError",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add ExecutorExhaustedError for when both executors unavailable",
        "file_path": "src/foundry_mcp/core/exceptions.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-11": {
      "type": "task",
      "title": "Add executor active workers metric",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add metric foundry_mcp_executor_active_workers (gauge)",
        "file_path": "src/foundry_mcp/core/executor.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-12": {
      "type": "task",
      "title": "Add executor queued tasks metric",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add metric foundry_mcp_executor_queued_tasks (gauge)",
        "file_path": "src/foundry_mcp/core/executor.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-13": {
      "type": "task",
      "title": "Add executor fallback counter",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add metric foundry_mcp_executor_fallback_total (counter)",
        "file_path": "src/foundry_mcp/core/executor.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-14": {
      "type": "task",
      "title": "Add executor isolation feature flag",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add feature flag providers.executor_isolation_enabled (default: true) for rollback",
        "file_path": "src/foundry_mcp/core/config.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-6-1": {
      "type": "verify",
      "title": "Test: load test executor",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Load test with 10 concurrent sessions, simulated 500ms blocking operation: all complete within 2x expected, no ExecutorExhaustedError, metrics show utilization",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-6-2": {
      "type": "verify",
      "title": "Test: graceful shutdown",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify graceful shutdown completes within drain timeout",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-6-3": {
      "type": "verify",
      "title": "Test: feature flag disables routing",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify feature flag disables executor routing",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-7": {
      "type": "phase",
      "title": "Test Integration & Coverage",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "verify-7-1",
        "task-7-1",
        "task-7-2",
        "task-7-3",
        "task-7-4",
        "verify-7-2",
        "task-7-5",
        "verify-7-3"
      ],
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Verify integration testing and coverage threshold across all phases.",
        "description": "Verify cross-cutting test coverage and fixture consistency after all implementation phases."
      },
      "dependencies": {
        "blocks": [
          "phase-8"
        ],
        "blocked_by": [
          "phase-6"
        ],
        "depends": []
      }
    },
    "verify-7-1": {
      "type": "verify",
      "title": "Run full test suite",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run full test suite, verify no regressions from phases 1-6",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-1": {
      "type": "task",
      "title": "Add cancellation integration test",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add integration test: full deep research flow with cancellation mid-way",
        "file_path": "tests/integration/test_deep_research_resilience.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-2": {
      "type": "task",
      "title": "Add timeout integration test",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add integration test: full deep research flow with timeout trigger",
        "file_path": "tests/integration/test_deep_research_resilience.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-3": {
      "type": "task",
      "title": "Add crash recovery integration test",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add integration test: crash recovery from cancelling state",
        "file_path": "tests/integration/test_deep_research_resilience.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-4": {
      "type": "task",
      "title": "Update response fixtures",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update response fixtures if schemas changed (timeout metadata, staleness, failed sub-queries)",
        "file_path": "tests/fixtures/",
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-7-2": {
      "type": "verify",
      "title": "Verify coverage threshold",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify all new code paths have >80% coverage (run coverage report)",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-5": {
      "type": "task",
      "title": "Fix coverage gaps",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Fix any coverage gaps identified in test files",
        "file_path": "tests/",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-7-3": {
      "type": "verify",
      "title": "Final test suite pass",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify make test passes with all new tests",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-8": {
      "type": "phase",
      "title": "Documentation",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-8-1",
        "task-8-2",
        "task-8-3",
        "task-8-4",
        "task-8-5",
        "task-8-6",
        "task-8-7",
        "task-8-8",
        "task-8-9",
        "task-8-10",
        "verify-8-1"
      ],
      "total_tasks": 11,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Document all new behavior, config options, and troubleshooting for resilience features.",
        "description": "Document new behavior, configuration options, and troubleshooting guidance."
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-7"
        ],
        "depends": []
      }
    },
    "task-8-1": {
      "type": "task",
      "title": "Document timeout behavior",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Document timeout behavior: task-level vs provider-level, precedence rules",
        "file_path": "docs/deep-research.md",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-8-2": {
      "type": "task",
      "title": "Document cancellation behavior",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Document cancellation behavior: two-phase model, cleanup guarantees, state transitions",
        "file_path": "docs/deep-research.md",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-8-3": {
      "type": "task",
      "title": "Document heartbeat/staleness behavior",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Document heartbeat/staleness detection behavior (informational vs terminal)",
        "file_path": "docs/deep-research.md",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-8-4": {
      "type": "task",
      "title": "Document crash recovery",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Document crash recovery: handling of cancelling state on restart",
        "file_path": "docs/deep-research.md",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-8-5": {
      "type": "task",
      "title": "Add timeout troubleshooting",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add troubleshooting: Task timed out - causes, config tuning, debugging",
        "file_path": "docs/troubleshooting.md",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-8-6": {
      "type": "task",
      "title": "Add cancellation troubleshooting",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add troubleshooting: Task cancelled - expected behavior, state recovery",
        "file_path": "docs/troubleshooting.md",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-8-7": {
      "type": "task",
      "title": "Add staleness troubleshooting",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add troubleshooting: Task stale - detection, causes (long provider calls), when to worry",
        "file_path": "docs/troubleshooting.md",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-8-8": {
      "type": "task",
      "title": "Document new config options",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Document new config options with defaults: research.deep_research_timeout, providers.executor_* (if Phase 6 implemented)",
        "file_path": "docs/configuration.md",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-8-9": {
      "type": "task",
      "title": "Update tool descriptions",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update tool descriptions with timeout parameter semantics",
        "file_path": "src/foundry_mcp/routers/research.py",
        "task_category": "refactoring"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-8-10": {
      "type": "task",
      "title": "Update CHANGELOG",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update CHANGELOG.md with new resilience features",
        "file_path": "CHANGELOG.md",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-8-1": {
      "type": "verify",
      "title": "Verify docs build",
      "status": "pending",
      "parent": "phase-8",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify docs build without warnings",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-6": {
      "type": "verify",
      "title": "Fidelity review: Task Registry & Cancellation",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify TaskRegistry, two-phase cancellation, and state transitions match spec requirements",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-5": {
      "type": "verify",
      "title": "Fidelity review: Timeout Watchdog",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify active watchdog polling, timeout detection, and staleness reporting match spec",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-4": {
      "type": "verify",
      "title": "Fidelity review: Provider Timeout Enforcement",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify all providers enforce timeouts with ProviderTimeoutError per spec pattern",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-4": {
      "type": "verify",
      "title": "Fidelity review: Progress Heartbeats",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify audit events, heartbeat timing, and metrics match spec",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-5-4": {
      "type": "verify",
      "title": "Fidelity review: Default Timeout Configuration",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify config precedence and defaults match spec",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-6-4": {
      "type": "verify",
      "title": "Fidelity review: Executor Isolation",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify executor implementation matches spec (if audit found blocking ops)",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    }
  },
  "journal": []
}