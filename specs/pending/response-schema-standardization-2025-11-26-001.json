{
  "spec_id": "response-schema-standardization-2025-11-26-001",
  "title": "MCP Tool Response Schema Standardization",
  "generated": "2025-11-26T12:00:00Z",
  "last_updated": "2025-11-26T18:24:27.624330Z",
  "metadata": {
    "description": "Standardize all MCP tool response schemas across 8 modules to ensure consistent JSON responses for client integration, MCP protocol alignment, and predictable parsing.",
    "objectives": [
      "All tools return consistent {success: bool, data: {...}, error: ...} structure",
      "Eliminate mixed patterns (found vs success vs none)",
      "Uniform error handling across all tools",
      "Enable predictable client parsing without tool-specific branching"
    ],
    "complexity": "medium",
    "estimated_hours": 12,
    "assumptions": [
      "Backward compatibility is not required (breaking change acceptable)",
      "schema_version field will be removed for consistency",
      "Response wrapper utility will be added to core module"
    ]
  },
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "MCP Tool Response Schema Standardization",
      "status": "pending",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4"
      ],
      "total_tasks": 27,
      "completed_tasks": 0,
      "metadata": {}
    },
    "phase-1": {
      "type": "phase",
      "title": "Define Standard Response Contract",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-1-files",
        "phase-1-verify"
      ],
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Create the canonical response schema and helper utilities",
        "risk_level": "low",
        "estimated_hours": 2
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3"
      ],
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-1-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "src/foundry_mcp/core/responses.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-1-1",
        "task-1-1-2",
        "task-1-1-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/core/responses.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Create new module for standardized response handling"
      },
      "dependencies": {
        "blocks": [
          "task-1-2",
          "task-1-3"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1-1": {
      "type": "subtask",
      "title": "Define ToolResponse dataclass with success, data, error fields",
      "status": "pending",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Create @dataclass ToolResponse with: success: bool, data: Dict[str, Any], error: Optional[str]"
      }
    },
    "task-1-1-2": {
      "type": "subtask",
      "title": "Create success_response() helper function",
      "status": "pending",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Helper that wraps data in standard success format: {success: true, ...data, error: null}"
      }
    },
    "task-1-1-3": {
      "type": "subtask",
      "title": "Create error_response() helper function",
      "status": "pending",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Helper that creates standard error format: {success: false, error: message}"
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "src/foundry_mcp/core/__init__.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-1-1"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/core/__init__.py",
        "task_category": "implementation",
        "estimated_hours": 0.25,
        "changes": "Export response utilities from core module"
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "Document response contract in responses.py docstrings",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-1-1"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/core/responses.py",
        "task_category": "implementation",
        "estimated_hours": 0.25,
        "changes": "Add module and function docstrings explaining the standard contract"
      }
    },
    "phase-1-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "verify-1-1",
        "verify-1-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-1-files"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Response utilities are importable",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -c \"from foundry_mcp.core.responses import success_response, error_response\"",
        "expected": "No import errors"
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "Response helpers produce correct format",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/test_responses.py -v",
        "expected": "All response format tests pass"
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Fix Critical Inconsistencies (Tasks & Queries)",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-2-files",
        "phase-2-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-1"
        ],
        "depends": [],
        "blocks": [
          "phase-3"
        ]
      },
      "total_tasks": 10,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Address the most broken modules first - tasks.py and queries.py have the worst inconsistencies",
        "risk_level": "medium",
        "estimated_hours": 4
      }
    },
    "phase-2-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "task-2-1",
        "task-2-2"
      ],
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-2-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "src/foundry_mcp/tools/tasks.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-1-1",
        "task-2-1-2",
        "task-2-1-3",
        "task-2-1-4",
        "task-2-1-5"
      ],
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/tasks.py",
        "task_category": "refactoring",
        "estimated_hours": 2,
        "changes": "Standardize all 6 inconsistent tools to use success_response/error_response",
        "reasoning": "Tasks module has the most critical inconsistencies: found vs success, missing success fields"
      }
    },
    "task-2-1-1": {
      "type": "subtask",
      "title": "Fix foundry_next_task: replace 'found' with 'success'",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Change response from {found: bool, ...} to success_response({found: bool, ...})"
      }
    },
    "task-2-1-2": {
      "type": "subtask",
      "title": "Fix foundry_task_info: add success field wrapper",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Wrap response in success_response(), use error_response() for errors"
      }
    },
    "task-2-1-3": {
      "type": "subtask",
      "title": "Fix foundry_check_deps: add success field wrapper",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Wrap response in success_response(), use error_response() for errors"
      }
    },
    "task-2-1-4": {
      "type": "subtask",
      "title": "Fix foundry_progress: add success field wrapper",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Wrap response in success_response(), use error_response() for errors"
      }
    },
    "task-2-1-5": {
      "type": "subtask",
      "title": "Fix foundry_prepare_task: standardize variable return",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Ensure core_prepare_task returns standard format or wrap its return"
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "src/foundry_mcp/tools/queries.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-2-1",
        "task-2-2-2",
        "task-2-2-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/queries.py",
        "task_category": "refactoring",
        "estimated_hours": 1.5,
        "changes": "Standardize all 3 query tools to use success_response/error_response",
        "reasoning": "Query tools have no success indicator at all, rely on presence of error field"
      }
    },
    "task-2-2-1": {
      "type": "subtask",
      "title": "Fix foundry_find_specs: replace 'found' with 'success'",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Change from {found: bool, ...} to success_response({found: bool, ...})"
      }
    },
    "task-2-2-2": {
      "type": "subtask",
      "title": "Fix foundry_list_specs: add success field",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Wrap {specs: [...], count: int} in success_response()"
      }
    },
    "task-2-2-3": {
      "type": "subtask",
      "title": "Fix foundry_query_tasks: add success field",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Wrap {spec_id: str, tasks: [...], count: int} in success_response()"
      }
    },
    "phase-2-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "verify-2-1",
        "verify-2-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-2-files"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Task tools return standard format",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/test_tasks.py -v",
        "expected": "All task tool tests pass with new response format"
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "Query tools return standard format",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/test_queries.py -v",
        "expected": "All query tool tests pass with new response format"
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Standardize Remaining Modules",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-3-files",
        "phase-3-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-2"
        ],
        "depends": [],
        "blocks": [
          "phase-4"
        ]
      },
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Update tools that are mostly consistent but need alignment - remove schema_version, align response structures",
        "risk_level": "low",
        "estimated_hours": 3
      }
    },
    "phase-3-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "task-3-1",
        "task-3-2",
        "task-3-3",
        "task-3-4"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-3-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "src/foundry_mcp/tools/docs.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/docs.py",
        "task_category": "refactoring",
        "estimated_hours": 0.75,
        "changes": "Remove schema_version field, use success_response wrapper, normalize impact_analysis and docs_stats dual responses"
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "src/foundry_mcp/tools/testing.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/testing.py",
        "task_category": "refactoring",
        "estimated_hours": 0.75,
        "changes": "Remove schema_version field, use success_response wrapper for all 4 testing tools"
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "src/foundry_mcp/tools/journal.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/journal.py",
        "task_category": "refactoring",
        "estimated_hours": 0.5,
        "changes": "Minor alignment - already consistent, just switch to using imported helpers"
      }
    },
    "task-3-4": {
      "type": "task",
      "title": "src/foundry_mcp/tools/validation.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/validation.py",
        "task_category": "refactoring",
        "estimated_hours": 0.5,
        "changes": "Minor alignment - already consistent, switch to using imported helpers"
      }
    },
    "phase-3-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "verify-3-1",
        "verify-3-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-3-files"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Docs and testing tools return standard format",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/test_docs.py tests/test_testing.py -v",
        "expected": "All docs and testing tool tests pass"
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "Journal and validation tools return standard format",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/test_journal.py tests/test_validation.py -v",
        "expected": "All journal and validation tool tests pass"
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Testing & Final Verification",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-4-files",
        "phase-4-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-3"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Ensure all changes work correctly, update tests to validate standard format, run full test suite",
        "risk_level": "low",
        "estimated_hours": 3
      }
    },
    "phase-4-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-1",
        "task-4-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-4-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "tests/test_responses.py",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/test_responses.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Create tests for response helper functions and standard format validation"
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Update existing tool tests for new response format",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "refactoring",
        "estimated_hours": 1.5,
        "changes": "Update test assertions across all tool test files to expect standard response format",
        "file_path": "task-4-2.md"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-4-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "verify-4-1",
        "verify-4-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-4-files"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-4-1": {
      "type": "verify",
      "title": "Full test suite passes",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest -v",
        "expected": "All tests pass"
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "Implementation fidelity review",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "spec",
        "target": "spec-root",
        "on_failure": {
          "consult": true,
          "revert_status": "in_progress",
          "continue_on_failure": false
        }
      }
    }
  }
}