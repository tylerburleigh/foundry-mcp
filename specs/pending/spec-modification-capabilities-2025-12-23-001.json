{
  "spec_id": "spec-modification-capabilities-2025-12-23-001",
  "title": "spec-modification-capabilities",
  "generated": "2025-12-23T14:54:29.088964Z",
  "last_updated": "2025-12-23T14:57:18.947430Z",
  "metadata": {
    "description": "Add validated spec modification capabilities across tasks, phases, bulk edits, and history while aligning with MCP contracts.",
    "objectives": [
      "Provide task and phase mutation actions with validated inputs and standard response envelopes.",
      "Support bulk updates and find/replace with safety limits, previews, and clear summaries.",
      "Add spec history, diff, rollback, and quality checks without breaking existing workflows.",
      "Prefer extending existing actions (update-metadata, metadata-batch, backup_spec, revision-add) instead of introducing duplicates."
    ],
    "complexity": "medium",
    "estimated_hours": 174.0,
    "assumptions": [
      "Extend existing routers/actions when possible; avoid new actions that duplicate current behavior."
    ],
    "owner": "",
    "category": "implementation",
    "template": "complex",
    "mission": "Enable safe, consistent modification of SDD specs via unified actions and validated inputs."
  },
  "progress_percentage": 0,
  "status": "pending",
  "current_phase": "phase-1",
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "spec-modification-capabilities",
      "status": "pending",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4",
        "phase-5",
        "phase-6",
        "phase-7"
      ],
      "total_tasks": 47,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Coordinate the rollout of spec modification tooling across core, routers, tests, and docs.",
        "category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "Planning & Discovery",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-1-1",
        "verify-1-1",
        "verify-1-2"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Initial planning and requirements gathering",
        "estimated_hours": 2
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Define requirements",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Document the requirements and acceptance criteria",
        "estimated_hours": 1,
        "file_path": "specs/pending/spec-modification-capabilities-2025-12-23-001.json",
        "task_category": "investigation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Run tests",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "run-tests",
        "mcp_tool": "mcp__foundry-mcp__test-run",
        "expected": "All tests pass"
      },
      "dependencies": {
        "blocks": [
          "verify-1-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "Fidelity review",
      "status": "pending",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "mcp_tool": "mcp__foundry-mcp__spec-review-fidelity",
        "scope": "phase",
        "target": "phase-1",
        "expected": "Implementation matches specification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-1-1"
        ],
        "depends": []
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Implementation",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-2-1",
        "verify-2-1",
        "verify-2-2"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Core implementation work",
        "estimated_hours": 8
      },
      "dependencies": {
        "blocks": [
          "phase-3"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "Implement core functionality",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Implement the main features",
        "estimated_hours": 4,
        "file_path": "src/foundry_mcp/core/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Run tests",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "run-tests",
        "mcp_tool": "mcp__foundry-mcp__test-run",
        "expected": "All tests pass"
      },
      "dependencies": {
        "blocks": [
          "verify-2-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "Fidelity review",
      "status": "pending",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "mcp_tool": "mcp__foundry-mcp__spec-review-fidelity",
        "scope": "phase",
        "target": "phase-2",
        "expected": "Implementation matches specification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-2-1"
        ],
        "depends": []
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Critical Task Operations",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "verify-3-1",
        "verify-3-2",
        "task-3-1",
        "task-3-2",
        "task-3-3",
        "task-3-4",
        "task-3-5",
        "task-3-6",
        "task-3-7"
      ],
      "total_tasks": 9,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Enable core editing capabilities (title updates via task.update-metadata and task.move) plus file_path bug fix",
        "description": "Implement editing task titles via task action `update-metadata` and reordering/reparenting tasks via task action `move`. Description updates are already handled by update-metadata.",
        "estimated_hours": 16.0
      },
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-2"
        ],
        "depends": []
      }
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Run tests",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "run-tests",
        "mcp_tool": "mcp__foundry-mcp__test-run",
        "expected": "All tests pass"
      },
      "dependencies": {
        "blocks": [
          "verify-3-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "Fidelity review",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "mcp_tool": "mcp__foundry-mcp__spec-review-fidelity",
        "scope": "phase",
        "target": "phase-3",
        "expected": "Implementation matches specification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-3-1"
        ],
        "depends": []
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Essential Structure Operations",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "verify-4-1",
        "verify-4-2",
        "task-4-1",
        "task-4-2",
        "task-4-3",
        "task-4-4",
        "task-4-5",
        "task-4-6",
        "task-4-7",
        "task-4-8"
      ],
      "total_tasks": 10,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Enable dependency management, phase reordering, and structured requirements",
        "description": "Add task actions `add-dependency`/`remove-dependency`, authoring action `phase-move`, and task action `add-requirement` for spec maintenance.",
        "estimated_hours": 20.0
      },
      "dependencies": {
        "blocks": [
          "phase-5"
        ],
        "blocked_by": [
          "phase-3"
        ],
        "depends": []
      }
    },
    "verify-4-1": {
      "type": "verify",
      "title": "Run tests",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "run-tests",
        "mcp_tool": "mcp__foundry-mcp__test-run",
        "expected": "All tests pass"
      },
      "dependencies": {
        "blocks": [
          "verify-4-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "Fidelity review",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "mcp_tool": "mcp__foundry-mcp__spec-review-fidelity",
        "scope": "phase",
        "target": "phase-4",
        "expected": "Implementation matches specification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-4-1"
        ],
        "depends": []
      }
    },
    "phase-5": {
      "type": "phase",
      "title": "Bulk Operations",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "verify-5-1",
        "verify-5-2",
        "task-5-1",
        "task-5-2",
        "task-5-3",
        "task-5-4",
        "task-5-5"
      ],
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Enable efficient batch updates and text replacement across specs",
        "description": "Extend task action `metadata-batch` with status/parent filters + description updates, and add authoring action `spec-find-replace` for large-scale modifications.",
        "estimated_hours": 12.0
      },
      "dependencies": {
        "blocks": [
          "phase-6"
        ],
        "blocked_by": [
          "phase-4"
        ],
        "depends": []
      }
    },
    "verify-5-1": {
      "type": "verify",
      "title": "Run tests",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "run-tests",
        "mcp_tool": "mcp__foundry-mcp__test-run",
        "expected": "All tests pass"
      },
      "dependencies": {
        "blocks": [
          "verify-5-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-5-2": {
      "type": "verify",
      "title": "Fidelity review",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "mcp_tool": "mcp__foundry-mcp__spec-review-fidelity",
        "scope": "phase",
        "target": "phase-5",
        "expected": "Implementation matches specification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-5-1"
        ],
        "depends": []
      }
    },
    "phase-6": {
      "type": "phase",
      "title": "History and Comparison",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "verify-6-1",
        "verify-6-2",
        "task-6-1",
        "task-6-2",
        "task-6-3",
        "task-6-4",
        "task-6-5",
        "task-6-6"
      ],
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Enable versioned backups with diff, history, and rollback capabilities",
        "description": "Enhance backup system for versioned backups, add spec actions `diff`/`history`, and add authoring action `spec-rollback`. History should surface both backups and existing revision_history entries.",
        "estimated_hours": 24.0
      },
      "dependencies": {
        "blocks": [
          "phase-7"
        ],
        "blocked_by": [
          "phase-5"
        ],
        "depends": []
      }
    },
    "verify-6-1": {
      "type": "verify",
      "title": "Run tests",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "run-tests",
        "mcp_tool": "mcp__foundry-mcp__test-run",
        "expected": "All tests pass"
      },
      "dependencies": {
        "blocks": [
          "verify-6-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-6-2": {
      "type": "verify",
      "title": "Fidelity review",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "mcp_tool": "mcp__foundry-mcp__spec-review-fidelity",
        "scope": "phase",
        "target": "phase-6",
        "expected": "Implementation matches specification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-6-1"
        ],
        "depends": []
      }
    },
    "phase-7": {
      "type": "phase",
      "title": "Validation Enhancements",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "verify-7-1",
        "verify-7-2",
        "task-7-1",
        "task-7-2",
        "task-7-3",
        "task-7-4",
        "task-7-5"
      ],
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Add completeness checking and duplicate detection",
        "description": "Add spec actions `completeness-check` and `duplicate-detection` for spec quality validation, reusing existing validation signals to avoid duplicate logic.",
        "estimated_hours": 10.0
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-6"
        ],
        "depends": []
      }
    },
    "verify-7-1": {
      "type": "verify",
      "title": "Run tests",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "run-tests",
        "mcp_tool": "mcp__foundry-mcp__test-run",
        "expected": "All tests pass"
      },
      "dependencies": {
        "blocks": [
          "verify-7-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-7-2": {
      "type": "verify",
      "title": "Fidelity review",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "mcp_tool": "mcp__foundry-mcp__spec-review-fidelity",
        "scope": "phase",
        "target": "phase-7",
        "expected": "Implementation matches specification"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-7-1"
        ],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "Extend update_task_metadata() for title updates",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Extend update_task_metadata() to support updating the task title (core field). Keep description updates in update-metadata to avoid duplicate actions. Support dry_run mode. Validate at least one field is provided. Return previous values.",
        "estimated_hours": 3.0,
        "file_path": "src/foundry_mcp/core/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "Extend _handle_update_metadata() handler to accept title",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update existing `update-metadata` action in task router to accept title updates. Validate spec_id/task_id and input fields. Call update_task_metadata(). Use response helpers and error semantics.",
        "estimated_hours": 2.0,
        "file_path": "src/foundry_mcp/tools/unified/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "Add move_task() function to core/task.py",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement move_task() to reorder within parent or reparent to different phase/task. Update task counts on affected parents. Prevent circular references. Emit dependency warnings for cross-phase moves. Support dry_run.",
        "estimated_hours": 4.0,
        "file_path": "src/foundry_mcp/core/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-4": {
      "type": "task",
      "title": "Add _handle_move() handler to task router",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Register action `move` in task router. Validate target_parent and position. Call move_task(). Use response helpers and include dependency warnings.",
        "estimated_hours": 2.0,
        "file_path": "src/foundry_mcp/tools/unified/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-5": {
      "type": "task",
      "title": "Fix file_path handling and add tests",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Verify file_path persistence through update-metadata action. Add explicit test cases for file_path set on add, update via update-metadata, persistence across load/save, and empty string handling.",
        "estimated_hours": 2.0,
        "file_path": "src/foundry_mcp/core/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-6": {
      "type": "task",
      "title": "Write tests for update-metadata title updates",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create test_task_update.py with tests: update title only via update-metadata, update description only, update both, dry_run mode, empty title error, nonexistent task error, no fields error.",
        "estimated_hours": 2.0,
        "file_path": "tests/unit/test_core/test_task_update.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-7": {
      "type": "task",
      "title": "Write tests for task.move action",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create test_task_move.py with tests: reorder within phase, reparent to different phase, reparent with position, move to self error, move to descendant error, invalid position error, dry_run, dependency warning.",
        "estimated_hours": 2.0,
        "file_path": "tests/unit/test_core/test_task_move.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "Add manage_task_dependency() function to core",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement function to add/remove blocks, blocked_by, depends relationships. Prevent circular dependencies via graph traversal. Update both source and target tasks atomically with clear errors.",
        "estimated_hours": 4.0,
        "file_path": "src/foundry_mcp/core/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Add _handle_add_dependency() and _handle_remove_dependency() handlers",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Register actions `add-dependency` and `remove-dependency` in task router. Accept depends_on/blocks parameters. Validate IDs, prevent cycles, use response helpers.",
        "estimated_hours": 2.0,
        "file_path": "src/foundry_mcp/tools/unified/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "Add move_phase() function to core/spec.py",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement function to reorder phases in spec-root children array. Update phase dependencies if link_previous pattern exists. Support dry_run mode.",
        "estimated_hours": 3.0,
        "file_path": "src/foundry_mcp/core/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-4": {
      "type": "task",
      "title": "Add _handle_phase_move() handler to authoring router",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Register `phase-move` action in authoring router. Accept phase_id and position parameters. Validate bounds and update dependencies.",
        "estimated_hours": 2.0,
        "file_path": "src/foundry_mcp/tools/unified/authoring.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-5": {
      "type": "task",
      "title": "Add update_task_requirements() function to core",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement function to add/remove structured requirements in metadata.requirements. Support requirement types: acceptance, technical, constraint. Update schema + validation for requirements shape and limits.",
        "estimated_hours": 2.0,
        "file_path": "src/foundry_mcp/core/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-6": {
      "type": "task",
      "title": "Add _handle_add_requirement() handler to task router",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Register `add-requirement` action in task router. Accept requirement text and requirement_type, validate input, use response helpers.",
        "estimated_hours": 1.0,
        "file_path": "src/foundry_mcp/tools/unified/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-7": {
      "type": "task",
      "title": "Write tests for dependency management",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Test add blocks relationship, add depends_on, remove dependency, circular dependency prevention.",
        "estimated_hours": 2.0,
        "file_path": "tests/unit/test_core/test_task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-8": {
      "type": "task",
      "title": "Write tests for phase.move and add-requirement",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Test phase reorder, dependency chain updates, add/remove requirements, default type, and schema/validation for requirements.",
        "estimated_hours": 2.0,
        "file_path": "tests/unit/test_core/test_spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-1": {
      "type": "task",
      "title": "Add batch_update_tasks() helper for metadata-batch",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement batch_update_tasks() to support task metadata-batch filtering by status/parent/pattern and updating description/metadata. Enforce regex + size limits, support dry_run, return matched/updated counts with warnings for skipped tasks.",
        "estimated_hours": 4.0,
        "file_path": "src/foundry_mcp/core/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-2": {
      "type": "task",
      "title": "Extend _handle_metadata_batch() handler to task router",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Update existing `metadata-batch` action to accept filter_status, filter_parent, filter_pattern, update_description, update_metadata; reuse batch_update_tasks(); update tool schema/docs/manifest.",
        "estimated_hours": 2.0,
        "file_path": "src/foundry_mcp/tools/unified/task.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-3": {
      "type": "task",
      "title": "Add find_replace_in_spec() function to core",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement literal and regex find/replace across spec. Support scope: all, titles, descriptions. Support dry_run preview, regex validation, and size limits. Return change summary + sample diffs.",
        "estimated_hours": 3.0,
        "file_path": "src/foundry_mcp/core/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-4": {
      "type": "task",
      "title": "Add _handle_spec_find_replace() handler to authoring router",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Register `spec-find-replace` action in authoring router. Accept find, replace, scope, use_regex parameters, validate input, use response helpers + error semantics.",
        "estimated_hours": 1.0,
        "file_path": "src/foundry_mcp/tools/unified/authoring.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-5": {
      "type": "task",
      "title": "Write tests for metadata-batch and spec-find-replace",
      "status": "pending",
      "parent": "phase-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Test metadata-batch by status/parent/pattern, description/metadata updates, and dry_run modes. Test spec-find-replace literal and regex, scope filtering, and preview summaries.",
        "estimated_hours": 2.0,
        "file_path": "tests/unit/test_core/test_task_batch_update.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-1": {
      "type": "task",
      "title": "Enhance backup_spec() for versioned backups",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create timestamped backups in .backups/{spec_id}/ directory. Maintain latest.json copy. Migrate or keep compatibility with existing .backups/{spec_id}.backup. Add configurable retention policy for max backups.",
        "estimated_hours": 4.0,
        "file_path": "src/foundry_mcp/core/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-2": {
      "type": "task",
      "title": "Add list_spec_backups() function to core",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "List backups chronologically for a spec with cursor pagination (meta.pagination). Return timestamps, file sizes, and paths; enforce page_size limits. Reuse outputs in spec.history alongside revision_history (avoid duplicating revision-add).",
        "estimated_hours": 2.0,
        "file_path": "src/foundry_mcp/core/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-3": {
      "type": "task",
      "title": "Add diff_specs() function to core",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Compare current spec vs backup or two specs. Categorize changes as added, removed, modified. Include task-level diff details. Support max_results/partial flag for large diffs.",
        "estimated_hours": 5.0,
        "file_path": "src/foundry_mcp/core/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-4": {
      "type": "task",
      "title": "Add rollback_spec() function to core",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Restore spec from specific backup timestamp. Create backup of current state before rollback. Support dry_run mode. Validate requested backup exists and enforce safety checks.",
        "estimated_hours": 3.0,
        "file_path": "src/foundry_mcp/core/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-5": {
      "type": "task",
      "title": "Add _handle_diff(), _handle_history(), and _handle_spec_rollback() handlers",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Register spec actions `diff` and `history` in spec router, and authoring action `spec-rollback` in authoring router. History should merge backup entries with metadata.revision_history. Use response helpers, error semantics, and pagination.",
        "estimated_hours": 3.0,
        "file_path": "src/foundry_mcp/tools/unified/spec.py; src/foundry_mcp/tools/unified/authoring.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-6": {
      "type": "task",
      "title": "Write tests for versioned backups and history operations",
      "status": "pending",
      "parent": "phase-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Test backup creation, listing with pagination, diff against backup/spec, rollback to previous/timestamp, backup before rollback, and partial diff handling.",
        "estimated_hours": 3.0,
        "file_path": "tests/unit/test_core/test_spec_history.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-1": {
      "type": "task",
      "title": "Add check_spec_completeness() function to core",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Flag tasks with empty descriptions by reusing existing validation checks. Compare against original plan file if provided (safe path validation). Calculate completeness score (0-100).",
        "estimated_hours": 3.0,
        "file_path": "src/foundry_mcp/core/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-2": {
      "type": "task",
      "title": "Add _handle_completeness_check() handler to spec router",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Register `completeness-check` action in spec router. Accept plan_path and check_descriptions parameters, reuse validation diagnostics for missing descriptions, validate inputs and path safety, and use response helpers.",
        "estimated_hours": 1.0,
        "file_path": "src/foundry_mcp/tools/unified/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-3": {
      "type": "task",
      "title": "Add detect_duplicate_tasks() function to core",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Compare task titles/descriptions using similarity threshold. Support scope: titles, descriptions, both. Limit pair count and return partial flag + warnings when truncated. Keep output structured to avoid overlap with review prompts.",
        "estimated_hours": 3.0,
        "file_path": "src/foundry_mcp/core/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-4": {
      "type": "task",
      "title": "Add _handle_duplicate_detection() handler to spec router",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Register `duplicate-detection` action in spec router. Accept similarity_threshold, scope, max_results parameters, validate inputs and return warnings for truncation. Keep response machine-readable (no narrative review).",
        "estimated_hours": 1.0,
        "file_path": "src/foundry_mcp/tools/unified/spec.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-7-5": {
      "type": "task",
      "title": "Write tests for completeness-check and duplicate-detection",
      "status": "pending",
      "parent": "phase-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Test empty description flagging, plan comparison, completeness score, duplicate detection with various thresholds, and truncation behavior.",
        "estimated_hours": 2.0,
        "file_path": "tests/unit/test_core/test_spec_validation.py",
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    }
  },
  "journal": []
}
