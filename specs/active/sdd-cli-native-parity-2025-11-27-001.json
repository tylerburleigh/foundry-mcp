{
  "spec_id": "sdd-cli-native-parity-2025-11-27-001",
  "title": "SDD CLI Native Re-Implementation - Foundry MCP",
  "generated": "2025-11-27T20:25:00Z",
  "last_updated": "2025-11-28T18:19:48.392855Z",
  "metadata": {
    "description": "Re-implement the Spec-Driven Development CLI inside foundry-mcp (Option A) so that MCP tools and the CLI share the same service layer, contracts, and resilience/observability guardrails.",
    "objectives": [
      "Achieve full parity with claude_skills SDD CLI commands without shelling out",
      "Share response helpers, validation, observability, and feature flags between CLI and MCP adapters",
      "Keep specs, docs, fixtures, and manifests in sync while introducing the native CLI"
    ],
    "complexity": "high",
    "estimated_hours": 180,
    "assumptions": [
      "Option A selected: native CLI package lives under src/foundry_mcp/sdd_cli and is the source of truth for both CLI and MCP tool behavior",
      "Best-practices consulted prior to authoring: docs/mcp_best_practices/01-versioned-contracts.md, 02-envelopes-metadata.md, 03-serialization-helpers.md, 04-validation-input-hygiene.md, 05-observability-telemetry.md, 06-pagination-streaming.md, 07-error-semantics.md, 08-security-trust-boundaries.md, 09-spec-driven-development.md, 10-testing-fixtures.md, 11-ai-llm-integration.md, 12-timeout-resilience.md, 13-tool-discovery.md, 14-feature-flags.md, 15-concurrency-patterns.md",
      "User-facing output consolidates on JSON (with optional plain-text/markdown summaries) \u2014 no bespoke rich UI or pretty-print layers",
      "New CLI must expose readiness/status via mcp/capabilities_manifest.json and discovery helpers before rollout"
    ],
    "status": "active",
    "owner": "foundry-mcp core",
    "progress_percentage": 12,
    "current_phase": "phase-1"
  },
  "progress_percentage": 0,
  "status": "pending",
  "current_phase": "phase-1",
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "SDD CLI Native Re-Implementation",
      "status": "in_progress",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4",
        "phase-5"
      ],
      "total_tasks": 50,
      "completed_tasks": 6,
      "metadata": {
        "purpose": "Deliver first-party SDD CLI runtime with shared MCP tooling"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "Discovery & Architecture",
      "status": "in_progress",
      "parent": "spec-root",
      "children": [
        "phase-1-planning",
        "phase-1-verify"
      ],
      "total_tasks": 8,
      "completed_tasks": 6,
      "metadata": {
        "purpose": "Establish scope, parity matrix, and architecture for Option A CLI",
        "risk_level": "medium",
        "estimated_hours": 30
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1-planning": {
      "type": "group",
      "title": "Planning & Documentation",
      "status": "in_progress",
      "parent": "phase-1",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3"
      ],
      "total_tasks": 7,
      "completed_tasks": 6,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-1-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Build command parity matrix",
      "status": "completed",
      "parent": "phase-1-planning",
      "children": [
        "task-1-1-1",
        "task-1-1-2",
        "task-1-1-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 3,
      "metadata": {
        "task_category": "investigation",
        "file_path": "docs/command_parity_matrix.md",
        "details": "Inventory every sdd/sdd doc/sdd test/sdd skills-dev command and map to foundry_mcp modules",
        "completed_at": "2025-11-28T18:14:36.715706Z",
        "needs_journaling": false,
        "journaled_at": "2025-11-28T18:14:36.717615Z"
      },
      "dependencies": {
        "blocks": [
          "task-1-2",
          "task-1-3"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1-1": {
      "type": "subtask",
      "title": "Export claude_skills CLI registry",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Capture claude_skills/claude_skills/cli/sdd/registry.py outputs for doc-query, run-tests, plan, etc.",
        "started_at": "2025-11-28T17:25:28.451496Z",
        "status_note": "Starting to capture CLI registry outputs",
        "completed_at": "2025-11-28T17:28:39.667049Z",
        "needs_journaling": false,
        "actual_hours": 0.053,
        "journaled_at": "2025-11-28T17:28:39.670245Z"
      }
    },
    "task-1-1-2": {
      "type": "subtask",
      "title": "Classify overlap with existing MCP adapters",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Mark commands already wrapped (environment, plan, next) vs gaps",
        "started_at": "2025-11-28T17:29:08.229495Z",
        "status_note": "Classifying overlap between CLI commands and existing MCP adapters",
        "completed_at": "2025-11-28T17:29:59.719688Z",
        "needs_journaling": false,
        "actual_hours": 0.014,
        "journaled_at": "2025-11-28T17:29:59.722616Z"
      }
    },
    "task-1-1-3": {
      "type": "subtask",
      "title": "Define migration priority tiers",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Group commands into critical (core workflows), important (doc/test), and advanced (AI rendering)",
        "started_at": "2025-11-28T18:05:00.548106Z",
        "status_note": "Starting migration priority tier classification",
        "completed_at": "2025-11-28T18:14:06.625405Z",
        "needs_journaling": false,
        "actual_hours": 0.152,
        "journaled_at": "2025-11-28T18:14:06.628818Z"
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "Author runtime ADR",
      "status": "completed",
      "parent": "phase-1-planning",
      "children": [
        "task-1-2-1",
        "task-1-2-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 2,
      "metadata": {
        "task_category": "decision",
        "file_path": "docs/architecture/sdd_cli_runtime.md",
        "details": "Document module layout, dependency graph, and CLI vs MCP execution model",
        "completed_at": "2025-11-28T18:18:12.759886Z",
        "needs_journaling": false,
        "journaled_at": "2025-11-28T18:18:12.761891Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-1"
        ],
        "depends": []
      }
    },
    "task-1-2-1": {
      "type": "subtask",
      "title": "Define package boundaries",
      "status": "completed",
      "parent": "task-1-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Choose namespace structure (sdd_cli/runtime, sdd_cli/commands, shared services)",
        "started_at": "2025-11-28T18:15:19.674622Z",
        "status_note": "Defining package boundaries for SDD CLI native implementation",
        "completed_at": "2025-11-28T18:16:24.161518Z",
        "needs_journaling": false,
        "actual_hours": 0.018,
        "journaled_at": "2025-11-28T18:16:24.164778Z"
      }
    },
    "task-1-2-2": {
      "type": "subtask",
      "title": "Describe shared helper strategy",
      "status": "completed",
      "parent": "task-1-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Reference core responses, validation, observability, and resilience helpers",
        "started_at": "2025-11-28T18:16:41.773741Z",
        "status_note": "Documenting shared helper strategy in ADR",
        "completed_at": "2025-11-28T18:17:45.742694Z",
        "needs_journaling": false,
        "actual_hours": 0.018,
        "journaled_at": "2025-11-28T18:17:45.745901Z"
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "Define release readiness plan",
      "status": "in_progress",
      "parent": "phase-1-planning",
      "children": [
        "task-1-3-1",
        "task-1-3-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 1,
      "metadata": {
        "task_category": "decision",
        "details": "Outline release sequencing, feature flags, and readiness criteria for enabling the native CLI"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-1"
        ],
        "depends": []
      }
    },
    "task-1-3-1": {
      "type": "subtask",
      "title": "Draft feature-flag controls",
      "status": "completed",
      "parent": "task-1-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Specify discovery + capabilities manifest switches for native CLI",
        "started_at": "2025-11-28T18:18:44.219448Z",
        "status_note": "Drafting feature-flag controls for native CLI release",
        "completed_at": "2025-11-28T18:19:48.387153Z",
        "needs_journaling": false,
        "actual_hours": 0.018,
        "journaled_at": "2025-11-28T18:19:48.391482Z"
      }
    },
    "task-1-3-2": {
      "type": "subtask",
      "title": "Document release checklist",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Capture enablement checklist, communication notes, and readiness signals for launch"
      }
    },
    "phase-1-verify": {
      "type": "group",
      "title": "Discovery Verification",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "verify-1-1"
      ],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-1-planning"
        ],
        "depends": []
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Architecture review sign-off",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Pariry matrix + ADR reviewed by maintainers",
        "command": "review docs/command_parity_matrix.md and docs/architecture/sdd_cli_runtime.md"
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Runtime & Shared Services",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-2-implementation",
        "phase-2-verify"
      ],
      "total_tasks": 10,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Create native CLI runtime, printers, config loading, and entry points",
        "risk_level": "medium",
        "estimated_hours": 35
      },
      "dependencies": {
        "blocks": [
          "phase-3"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      }
    },
    "phase-2-implementation": {
      "type": "group",
      "title": "Runtime Implementation",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "task-2-1",
        "task-2-2",
        "task-2-3"
      ],
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-2-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "Scaffold sdd_cli runtime package",
      "status": "pending",
      "parent": "phase-2-implementation",
      "children": [
        "task-2-1-1",
        "task-2-1-2",
        "task-2-1-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/runtime/__init__.py",
        "details": "Create argparse scaffolding, shared options, and CLI context objects"
      },
      "dependencies": {
        "blocks": [
          "task-2-2",
          "task-2-3"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-1-1": {
      "type": "subtask",
      "title": "Implement argument parser + registry",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Port claude_skills CLI global options (verbosity, json, specs-dir)"
      }
    },
    "task-2-1-2": {
      "type": "subtask",
      "title": "Create printer/json output helpers",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Map claude_skills.common PrettyPrinter behavior onto observability helpers"
      }
    },
    "task-2-1-3": {
      "type": "subtask",
      "title": "Wire configuration + workspace detection",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Leverage foundry_mcp.config + path helpers for specs directory"
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "Expose console entry point",
      "status": "pending",
      "parent": "phase-2-implementation",
      "children": [
        "task-2-2-1",
        "task-2-2-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "pyproject.toml",
        "details": "Add console script (sdd-native) referencing foundry_mcp.sdd_cli.__main__"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-1"
        ],
        "depends": []
      }
    },
    "task-2-2-1": {
      "type": "subtask",
      "title": "Create __main__ launcher",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Initialize FastMCP config, metrics, and event loop"
      }
    },
    "task-2-2-2": {
      "type": "subtask",
      "title": "Update packaging + entry points",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Add console_scripts and ensure dependencies vendored"
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "Resilience & telemetry scaffolding",
      "status": "pending",
      "parent": "phase-2-implementation",
      "children": [
        "task-2-3-1",
        "task-2-3-2",
        "task-2-3-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/runtime/resilience.py",
        "details": "Integrate core/resilience, observability, concurrency, and tracing helpers"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-1"
        ],
        "depends": []
      }
    },
    "task-2-3-1": {
      "type": "subtask",
      "title": "Timeout + cancellation wrappers",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Expose decorators for CLI commands using core/resilience FAST_TIMEOUT + SAFE_TIMEOUT"
      }
    },
    "task-2-3-2": {
      "type": "subtask",
      "title": "Structured logging hooks",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Emit context IDs + metrics per docs/mcp_best_practices/05"
      }
    },
    "task-2-3-3": {
      "type": "subtask",
      "title": "Feature-flag bootstrap",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Add shared flag registry bridging CLI options and discovery manifest"
      }
    },
    "phase-2-verify": {
      "type": "group",
      "title": "Runtime Verification",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "verify-2-1",
        "verify-2-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-2-implementation"
        ],
        "depends": []
      }
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Runtime unit tests",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/unit/test_sdd_cli_runtime.py -v",
        "expected": "Parsers, printers, and config helpers covered"
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "Console entry smoke test",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "sdd-native --help succeeds and shows global options"
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Core Operations Migration",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-3-implementation",
        "phase-3-testing"
      ],
      "total_tasks": 12,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Port planning, next-task, update/progress, context, and validation commands",
        "risk_level": "high",
        "estimated_hours": 45
      },
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-2"
        ],
        "depends": []
      }
    },
    "phase-3-implementation": {
      "type": "group",
      "title": "Core Command Ports",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "task-3-1",
        "task-3-2",
        "task-3-3",
        "task-3-4"
      ],
      "total_tasks": 10,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-3-testing"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "Port planning commands",
      "status": "pending",
      "parent": "phase-3-implementation",
      "children": [
        "task-3-1-1",
        "task-3-1-2",
        "task-3-1-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/commands/plan.py",
        "details": "Port create/analyze/template commands leveraging existing MCP planning helpers"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-1-1": {
      "type": "subtask",
      "title": "sdd create",
      "status": "pending",
      "parent": "task-3-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Map spec templates to pending specs directory"
      }
    },
    "task-3-1-2": {
      "type": "subtask",
      "title": "sdd analyze",
      "status": "pending",
      "parent": "task-3-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Integrate doc-query stats + workspace detection"
      }
    },
    "task-3-1-3": {
      "type": "subtask",
      "title": "sdd template commands",
      "status": "pending",
      "parent": "task-3-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "List/show templates with verbosity filtering"
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "Port next-task & preparation workflows",
      "status": "pending",
      "parent": "phase-3-implementation",
      "children": [
        "task-3-2-1",
        "task-3-2-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/commands/next.py",
        "details": "Implement next-task, prepare-task, task-info, dependency checks"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-2-1": {
      "type": "subtask",
      "title": "sdd next-task",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Reuse existing MCP next-task logic"
      }
    },
    "task-3-2-2": {
      "type": "subtask",
      "title": "sdd prepare-task/task-info",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Ensure envelope + pagination semantics"
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "Port update/status/context commands",
      "status": "pending",
      "parent": "phase-3-implementation",
      "children": [
        "task-3-3-1",
        "task-3-3-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/commands/update.py",
        "details": "Implement status updates, journaling, context tracker"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-3-1": {
      "type": "subtask",
      "title": "Progress updates",
      "status": "pending",
      "parent": "task-3-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "sdd update-status, mark-blocked, activate/complete spec"
      }
    },
    "task-3-3-2": {
      "type": "subtask",
      "title": "Context tracker/limits",
      "status": "pending",
      "parent": "task-3-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Integrate consultation limits + session markers"
      }
    },
    "task-3-4": {
      "type": "task",
      "title": "Port validation + fix/report commands",
      "status": "pending",
      "parent": "phase-3-implementation",
      "children": [
        "task-3-4-1",
        "task-3-4-2",
        "task-3-4-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/commands/validate.py",
        "details": "sdd validate, fix, report, stats, analyze-deps"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-4-1": {
      "type": "subtask",
      "title": "Validation command",
      "status": "pending",
      "parent": "task-3-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Wire schema validation + error semantics"
      }
    },
    "task-3-4-2": {
      "type": "subtask",
      "title": "Auto-fix + diff",
      "status": "pending",
      "parent": "task-3-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Implement fix/report commands with resilience"
      }
    },
    "task-3-4-3": {
      "type": "subtask",
      "title": "Stats + deps",
      "status": "pending",
      "parent": "task-3-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Expose stats/analyze-deps outputs with pagination"
      }
    },
    "phase-3-testing": {
      "type": "group",
      "title": "Core Testing",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "verify-3-1",
        "verify-3-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-3-implementation"
        ],
        "depends": []
      }
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Core CLI unit tests",
      "status": "pending",
      "parent": "phase-3-testing",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/unit/test_sdd_cli_core.py -v",
        "expected": "Planning/next/update/validate commands covered"
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "Spec fixture parity",
      "status": "pending",
      "parent": "phase-3-testing",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Compare CLI output vs claude_skills for representative fixtures"
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Advanced Workflows",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-4-implementation",
        "phase-4-testing"
      ],
      "total_tasks": 11,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Port AI-assisted workflows (render, plan review, PR, spec modifications, doc-query, run-tests)",
        "risk_level": "high",
        "estimated_hours": 45
      },
      "dependencies": {
        "blocks": [
          "phase-5"
        ],
        "blocked_by": [
          "phase-3"
        ],
        "depends": []
      }
    },
    "phase-4-implementation": {
      "type": "group",
      "title": "Advanced Command Ports",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-1",
        "task-4-2",
        "task-4-3",
        "task-4-4"
      ],
      "total_tasks": 9,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-4-testing"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "Port sdd render",
      "status": "pending",
      "parent": "phase-4-implementation",
      "children": [
        "task-4-1-1",
        "task-4-1-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/commands/render.py",
        "details": "Integrate AI rendering with observability + concurrency guards"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-1-1": {
      "type": "subtask",
      "title": "Rendering pipeline",
      "status": "pending",
      "parent": "task-4-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Port orchestrator + prompt selection"
      }
    },
    "task-4-1-2": {
      "type": "subtask",
      "title": "Feature flags + rate limits",
      "status": "pending",
      "parent": "task-4-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Ensure render modes gated by capability flags"
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Port plan review & PR helpers",
      "status": "pending",
      "parent": "phase-4-implementation",
      "children": [
        "task-4-2-1",
        "task-4-2-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/commands/plan_review.py",
        "details": "sdd plan-review, sdd pr commands with AI prompts"
      }
    },
    "task-4-2-1": {
      "type": "subtask",
      "title": "Plan review",
      "status": "pending",
      "parent": "task-4-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Integrate review templates + fidelity hooks"
      }
    },
    "task-4-2-2": {
      "type": "subtask",
      "title": "PR tooling",
      "status": "pending",
      "parent": "task-4-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "sdd pr context, creation, and metadata"
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "Port spec modifications + doc-query",
      "status": "pending",
      "parent": "phase-4-implementation",
      "children": [
        "task-4-3-1",
        "task-4-3-2",
        "task-4-3-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/commands/spec_mod.py",
        "details": "Port spec modifications, doc-query workflows, and tooling"
      }
    },
    "task-4-3-1": {
      "type": "subtask",
      "title": "Spec modifications",
      "status": "pending",
      "parent": "task-4-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Apply modifications schema + helper diffing"
      }
    },
    "task-4-3-2": {
      "type": "subtask",
      "title": "Doc-query workflows",
      "status": "pending",
      "parent": "task-4-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Port doc-query CLI and integrate with runtime"
      }
    },
    "task-4-3-3": {
      "type": "subtask",
      "title": "Run-tests integration",
      "status": "pending",
      "parent": "task-4-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Expose sdd test run/check-tools/consult commands"
      }
    },
    "task-4-4": {
      "type": "task",
      "title": "Port llm doc gen + skills dev CLI",
      "status": "pending",
      "parent": "phase-4-implementation",
      "children": [
        "task-4-4-1",
        "task-4-4-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "src/foundry_mcp/sdd_cli/commands/doc_cli.py",
        "details": "Bring over llm doc gen commands and skills-dev helpers for completeness"
      }
    },
    "task-4-4-1": {
      "type": "subtask",
      "title": "LLM doc generation",
      "status": "pending",
      "parent": "task-4-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Integrate AI doc gen pipelines with concurrency controls"
      }
    },
    "task-4-4-2": {
      "type": "subtask",
      "title": "Skills-dev utilities",
      "status": "pending",
      "parent": "task-4-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Port gendocs/install helper/start helper"
      }
    },
    "phase-4-testing": {
      "type": "group",
      "title": "Advanced Testing",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "verify-4-1",
        "verify-4-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-4-implementation"
        ],
        "depends": []
      }
    },
    "verify-4-1": {
      "type": "verify",
      "title": "Advanced workflow tests",
      "status": "pending",
      "parent": "phase-4-testing",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/integration/test_sdd_cli_advanced.py -v",
        "expected": "Render/doc-query/spec-mod/run-tests flows validated"
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "AI workflow review",
      "status": "pending",
      "parent": "phase-4-testing",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-4"
      }
    },
    "phase-5": {
      "type": "phase",
      "title": "Parity Validation & Rollout",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-5-delivery",
        "phase-5-verify"
      ],
      "total_tasks": 9,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Validate parity vs legacy CLI, update manifest/docs, plan rollout",
        "risk_level": "medium",
        "estimated_hours": 30
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-4"
        ],
        "depends": []
      }
    },
    "phase-5-delivery": {
      "type": "group",
      "title": "Rollout Tasks",
      "status": "pending",
      "parent": "phase-5",
      "children": [
        "task-5-1",
        "task-5-2",
        "task-5-3"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-5-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-1": {
      "type": "task",
      "title": "Parity regression harness",
      "status": "pending",
      "parent": "phase-5-delivery",
      "children": [
        "task-5-1-1",
        "task-5-1-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "tests/integration/test_sdd_cli_parity.py",
        "details": "Compare native CLI output to claude_skills reference via fixtures"
      }
    },
    "task-5-1-1": {
      "type": "subtask",
      "title": "Golden fixture capture",
      "status": "pending",
      "parent": "task-5-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Record baseline outputs for representative commands"
      }
    },
    "task-5-1-2": {
      "type": "subtask",
      "title": "Diff harness",
      "status": "pending",
      "parent": "task-5-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Automate CLI vs reference comparisons in CI"
      }
    },
    "task-5-2": {
      "type": "task",
      "title": "Docs + manifest updates",
      "status": "pending",
      "parent": "phase-5-delivery",
      "children": [
        "task-5-2-1",
        "task-5-2-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "file_path": "docs/mcp_best_practices/README.md",
        "details": "Update docs, changelog, half_baked_plans, and capabilities manifest"
      }
    },
    "task-5-2-1": {
      "type": "subtask",
      "title": "Capabilities manifest",
      "status": "pending",
      "parent": "task-5-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Expose CLI feature readiness + flags"
      }
    },
    "task-5-2-2": {
      "type": "subtask",
      "title": "Docs + backlog",
      "status": "pending",
      "parent": "task-5-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Update docs/mcp_best_practices/README.md and half_baked_plans/OPERATIONS_TO_ADD.md"
      }
    },
    "task-5-3": {
      "type": "task",
      "title": "Release enablement",
      "status": "pending",
      "parent": "phase-5-delivery",
      "children": [
        "task-5-3-1",
        "task-5-3-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "details": "Stage rollout plans, feature flags, and launch communications",
        "file_path": "task-5-3.py"
      }
    },
    "task-5-3-1": {
      "type": "subtask",
      "title": "Feature-flag rollout",
      "status": "pending",
      "parent": "task-5-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Enable native CLI via discovery flags and progressive rollout"
      }
    },
    "task-5-3-2": {
      "type": "subtask",
      "title": "Launch communication",
      "status": "pending",
      "parent": "task-5-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Publish launch notes and guidance for early adopters"
      }
    },
    "phase-5-verify": {
      "type": "group",
      "title": "Rollout Verification",
      "status": "pending",
      "parent": "phase-5",
      "children": [
        "verify-5-1",
        "verify-5-2",
        "verify-5-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-5-delivery"
        ],
        "depends": []
      }
    },
    "verify-5-1": {
      "type": "verify",
      "title": "Parity regression suite",
      "status": "pending",
      "parent": "phase-5-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/integration/test_sdd_cli_parity.py -v",
        "expected": "Legacy vs native outputs match for golden fixtures"
      }
    },
    "verify-5-2": {
      "type": "verify",
      "title": "Docs + manifest review",
      "status": "pending",
      "parent": "phase-5-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Docs, backlog, and capabilities manifest reflect native CLI status"
      }
    },
    "verify-5-3": {
      "type": "verify",
      "title": "Rollout readiness gate",
      "status": "pending",
      "parent": "phase-5-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-5"
      }
    }
  },
  "journal": [
    {
      "timestamp": "2025-11-28T17:28:39.670240Z",
      "entry_type": "status_change",
      "title": "Task Completed: Export claude_skills CLI registry",
      "author": "claude-code",
      "content": "Created comprehensive CLI parity matrix document at docs/cli_parity_matrix.md capturing all 70+ SDD CLI commands from claude_skills.cli.sdd.registry and mapping them to foundry-mcp MCP tools. Document includes: registry source analysis, command-to-tool mapping tables organized by category (Core Spec, Tasks, Validation, Journal, Lifecycle, Authoring, Verification, Documentation, Code Query, Testing, Review, PR Workflow, Environment, Analysis, Utilities, Context/Session, Cache, Schema/Discovery, Git), implementation status for each, and summary statistics showing ~85% overall parity coverage.",
      "metadata": {},
      "task_id": "task-1-1-1"
    },
    {
      "timestamp": "2025-11-28T17:29:59.722611Z",
      "entry_type": "status_change",
      "title": "Task Completed: Classify overlap with existing MCP adapters",
      "author": "claude-code",
      "content": "Added comprehensive 'Overlap Classification' section to docs/cli_parity_matrix.md with: (1) Already Wrapped - 50+ CLI commands with full MCP parity organized by category, (2) Partial Implementation - 3 commands needing enhancement (list-phases, doc scope, status-report), (3) Gaps - 9 CLI commands with no MCP equivalent prioritized by importance, (4) CLI-Specific - 3 commands that don't need MCP equivalents (context, session-marker, get-work-mode), (5) MCP-Only Tools - 20 tools that extend beyond CLI capabilities.",
      "metadata": {},
      "task_id": "task-1-1-2"
    },
    {
      "timestamp": "2025-11-28T18:14:06.628813Z",
      "entry_type": "status_change",
      "title": "Task Completed: Define migration priority tiers",
      "author": "claude-code",
      "content": "Added comprehensive Migration Priority Tiers section to docs/cli_parity_matrix.md with: (1) Tier 1 Critical - 2 gap commands (check-complete, create-task-commit) plus 1 partial enhancement (list-phases), essential for core workflows; (2) Tier 2 Important - 2 gap commands (bulk-journal, find-tests) plus 2 partial enhancements (doc scope, status-report), for documentation and testing; (3) Tier 3 Advanced - 5 deferred commands (time-report, phase-time, audit-spec, reconcile-state, format-plan) for AI rendering and analysis; (4) CLI-Specific - 3 commands that don't need migration (context, session-marker, get-work-mode); (5) Migration Effort Summary table showing 12 total items across tiers; (6) Recommended Implementation Order with phased approach. This completes the command parity matrix investigation phase.",
      "metadata": {},
      "task_id": "task-1-1-3"
    },
    {
      "timestamp": "2025-11-28T18:14:36.717609Z",
      "entry_type": "status_change",
      "title": "Task Completed: Build command parity matrix",
      "author": "claude-code",
      "content": "All 3 subtasks completed successfully. Built comprehensive command parity matrix in docs/cli_parity_matrix.md including: (1) task-1-1-1: Exported 79 CLI commands from claude_skills registry across 18 categories; (2) task-1-1-2: Classified overlap - 50+ commands with full MCP parity, 3 partial implementations, 9 gaps, 3 CLI-specific, and 20 MCP-only tools extending CLI; (3) task-1-1-3: Defined migration priority tiers - Tier 1 Critical (3 items), Tier 2 Important (4 items), Tier 3 Advanced (5 items). Overall CLI-to-MCP coverage is ~85% excluding CLI-specific commands. This completes the investigation phase and unblocks task-1-2 (Author runtime ADR) and task-1-3 (Define release readiness plan).",
      "metadata": {},
      "task_id": "task-1-1"
    },
    {
      "timestamp": "2025-11-28T18:16:24.164774Z",
      "entry_type": "status_change",
      "title": "Task Completed: Define package boundaries",
      "author": "claude-code",
      "content": "Created docs/architecture/sdd_cli_runtime.md with comprehensive ADR defining package boundaries: (1) foundry_mcp.core - transport-agnostic business logic (unchanged); (2) foundry_mcp.tools - MCP tool implementations (unchanged); (3) foundry_mcp.cli - NEW CLI runtime with main.py entry point; (4) foundry_mcp.cli.commands - Click command groups (spec, task, journal, lifecycle, validation, docs, test, review). Key decisions: core has no transport knowledge, tools and CLI are siblings both depending on core, CLI-specific features (context, session-marker, work_mode) stay in CLI package. Included dependency graph, entry point examples, pyproject.toml script config, and alternatives analysis (rejected flat module, separate package, and MCP wrapper approaches).",
      "metadata": {},
      "task_id": "task-1-2-1"
    },
    {
      "timestamp": "2025-11-28T18:17:45.745896Z",
      "entry_type": "status_change",
      "title": "Task Completed: Describe shared helper strategy",
      "author": "claude-code",
      "content": "Added comprehensive Shared Helper Strategy section to docs/architecture/sdd_cli_runtime.md documenting: (1) Core Helper Modules table mapping responses, validation, security, observability, resilience, and pagination to CLI usage patterns; (2) Response Adaptation Pattern showing how CLI adapts MCP response envelopes for JSON and human-readable modes; (3) Validation Helper Usage examples for sdd validate/fix commands; (4) Security Helpers showing shared limits (MAX_INPUT_SIZE, MAX_ARRAY_LENGTH, etc.) used by both MCP and CLI; (5) Pagination in CLI adapting core cursor-based pagination; (6) Resilience Patterns for file operations with retry logic; (7) CLI-Only Helpers table identifying cli/output.py, cli/config.py, cli/context.py, cli/progress.py as CLI-specific; (8) Helper Selection Criteria decision tree for choosing between core and CLI modules. This completes the shared helper documentation for the runtime ADR.",
      "metadata": {},
      "task_id": "task-1-2-2"
    },
    {
      "timestamp": "2025-11-28T18:18:12.761886Z",
      "entry_type": "status_change",
      "title": "Task Completed: Author runtime ADR",
      "author": "claude-code",
      "content": "Authored comprehensive runtime ADR in docs/architecture/sdd_cli_runtime.md with both subtasks completed: (1) task-1-2-1 defined package boundaries - foundry_mcp.core (transport-agnostic), foundry_mcp.tools (MCP), foundry_mcp.cli (CLI runtime), foundry_mcp.cli.commands (Click groups), with dependency graph and entry point examples; (2) task-1-2-2 described shared helper strategy - core modules (responses, validation, security, observability, resilience, pagination) usage patterns, response adaptation for CLI, security limits, pagination, resilience patterns, CLI-only helpers, and selection criteria. ADR includes context, decision rationale, alternatives considered (flat module, separate package, MCP wrapper - all rejected), and consequences analysis. This provides the architectural foundation for CLI implementation.",
      "metadata": {},
      "task_id": "task-1-2"
    },
    {
      "timestamp": "2025-11-28T18:19:48.391478Z",
      "entry_type": "status_change",
      "title": "Task Completed: Draft feature-flag controls",
      "author": "claude-code",
      "content": "Created docs/architecture/cli_release_readiness.md with comprehensive feature-flag controls: (1) CLI Discovery Flag (native_cli) with EXPERIMENTAL\u2192BETA\u2192STABLE lifecycle stages; (2) CLI Command Group Flags for granular rollout (cli_spec_commands, cli_task_commands, cli_journal_commands, cli_lifecycle_commands, cli_doc_commands, cli_test_commands, cli_review_commands) with depends_on relationships; (3) Capabilities Manifest Switches via get_cli_capabilities() function; (4) Configuration Override support via environment variables (FOUNDRY_CLI_ENABLED) and config file (.foundry/config.json); (5) CLI Entry Point Guard checking feature flag before command execution. Also documented rollout strategy with 4 phases (Internal Testing, Alpha, Beta, GA) and metrics/monitoring including success metrics, rollback triggers, and telemetry events.",
      "metadata": {},
      "task_id": "task-1-3-1"
    }
  ]
}