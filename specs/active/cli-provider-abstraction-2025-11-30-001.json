{
  "spec_id": "cli-provider-abstraction-2025-11-30-001",
  "generated": "2025-11-30T12:00:00Z",
  "last_updated": "2025-12-01T21:00:40.844390Z",
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "CLI Provider Abstraction Adoption",
      "status": "in_progress",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4",
        "phase-5",
        "phase-6",
        "task-3-1-1",
        "task-3-1-2",
        "task-3-1-3"
      ],
      "total_tasks": 67,
      "completed_tasks": 21,
      "metadata": {
        "description": "Port the unified CLI provider pattern from sdd-toolkit to foundry-mcp, enabling consistent handling of external AI tool CLIs (gemini, codex, cursor-agent, claude, opencode) while adhering to foundry-mcp conventions.",
        "objectives": [
          "Unified abstraction for 5 CLI providers",
          "MCP tool exposure (provider-list, provider-status, provider-execute)",
          "Response envelope compliance with foundry-mcp standards",
          "Integration with existing resilience patterns",
          "Documented rollout plus discovery metadata across CLI + MCP"
        ],
        "best_practice_refs": [
          "docs/mcp_best_practices/README.md#L24-L82",
          "docs/mcp_best_practices/01-versioned-contracts.md",
          "docs/mcp_best_practices/02-envelopes-metadata.md",
          "docs/mcp_best_practices/03-serialization-helpers.md",
          "docs/mcp_best_practices/04-validation-input-hygiene.md",
          "docs/mcp_best_practices/05-observability-telemetry.md",
          "docs/mcp_best_practices/07-error-semantics.md",
          "docs/mcp_best_practices/08-security-trust-boundaries.md",
          "docs/mcp_best_practices/09-spec-driven-development.md",
          "docs/mcp_best_practices/10-testing-fixtures.md",
          "docs/mcp_best_practices/11-ai-llm-integration.md",
          "docs/mcp_best_practices/12-timeout-resilience.md",
          "docs/mcp_best_practices/13-tool-discovery.md",
          "docs/mcp_best_practices/14-feature-flags.md",
          "docs/mcp_best_practices/15-concurrency-patterns.md",
          "docs/cli_best_practices/README.md",
          "docs/codebase_standards/naming-conventions.md",
          "docs/codebase_standards/cli-output.md"
        ]
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "Core Provider Abstractions",
      "status": "completed",
      "parent": "spec-root",
      "children": [
        "phase-1-files",
        "phase-1-verify"
      ],
      "total_tasks": 9,
      "completed_tasks": 9,
      "metadata": {
        "purpose": "Create foundational dataclasses, enums, and base ProviderContext ABC",
        "risk_level": "low",
        "reference_docs": [
          "docs/mcp_best_practices/01-versioned-contracts.md",
          "docs/mcp_best_practices/02-envelopes-metadata.md",
          "docs/mcp_best_practices/03-serialization-helpers.md",
          "docs/mcp_best_practices/04-validation-input-hygiene.md",
          "docs/mcp_best_practices/05-observability-telemetry.md"
        ],
        "needs_journaling": false,
        "completed_at": "2025-12-01T19:35:41.909240Z",
        "journaled_at": "2025-12-01T19:35:41.918868Z"
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "completed",
      "parent": "phase-1",
      "children": [
        "task-1-0",
        "task-1-1",
        "task-1-2"
      ],
      "total_tasks": 7,
      "completed_tasks": 7,
      "metadata": {
        "needs_journaling": false,
        "completed_at": "2025-12-01T19:34:04.667566Z",
        "journaled_at": "2025-12-01T19:34:04.675404Z"
      },
      "dependencies": {
        "blocks": [
          "phase-1-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-0": {
      "type": "task",
      "title": "Analyze sdd-toolkit provider base.py",
      "status": "completed",
      "parent": "phase-1-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-1"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "task_category": "investigation",
        "estimated_hours": 1,
        "description": "Review sdd-toolkit's base.py to understand ProviderContext, GenerationRequest, GenerationResult, enums, and error hierarchy. Note adaptations needed for foundry-mcp conventions.",
        "reference_docs": [
          "claude-sdd-toolkit/common/providers/base.py (2025-11-25 tag)",
          "docs/architecture/adr-001-cli-architecture.md"
        ],
        "started_at": "2025-12-01T19:25:04.908900Z",
        "status_note": "Starting analysis of sdd-toolkit provider base.py",
        "completed_at": "2025-12-01T19:26:07.924068Z",
        "needs_journaling": false,
        "actual_hours": 0.018,
        "journaled_at": "2025-12-01T19:26:07.928426Z"
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "src/foundry_mcp/core/providers/base.py",
      "status": "completed",
      "parent": "phase-1-files",
      "children": [
        "task-1-1-1",
        "task-1-1-2",
        "task-1-1-3",
        "task-1-1-4",
        "task-1-1-5"
      ],
      "dependencies": {
        "blocks": [
          "task-1-2"
        ],
        "blocked_by": [
          "task-1-0"
        ],
        "depends": []
      },
      "total_tasks": 5,
      "completed_tasks": 5,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/base.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "description": "Create core provider abstractions adapted from sdd-toolkit"
      }
    },
    "task-1-1-1": {
      "type": "subtask",
      "title": "Create ProviderCapability enum",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "TEXT, VISION, FUNCTION_CALLING, STREAMING capabilities",
        "started_at": "2025-12-01T19:26:44.636545Z",
        "status_note": "Creating ProviderCapability enum",
        "completed_at": "2025-12-01T19:27:11.849828Z",
        "needs_journaling": false,
        "actual_hours": 0.008,
        "journaled_at": "2025-12-01T19:27:11.854078Z"
      }
    },
    "task-1-1-2": {
      "type": "subtask",
      "title": "Create ProviderStatus enum with to_error_type()",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "SUCCESS, TIMEOUT, NOT_FOUND, INVALID_OUTPUT, ERROR with is_retryable() and to_error_type() mapping to foundry-mcp ErrorType",
        "started_at": "2025-12-01T19:27:47.250209Z",
        "status_note": "Creating ProviderStatus enum",
        "completed_at": "2025-12-01T19:29:17.465560Z",
        "needs_journaling": false,
        "actual_hours": 0.025,
        "journaled_at": "2025-12-01T19:29:17.470855Z"
      }
    },
    "task-1-1-3": {
      "type": "subtask",
      "title": "Create ProviderRequest dataclass",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "prompt, system_prompt, model, timeout, temperature, max_tokens, metadata fields",
        "started_at": "2025-12-01T19:29:49.323203Z",
        "status_note": "Creating ProviderRequest dataclass",
        "completed_at": "2025-12-01T19:30:17.724018Z",
        "needs_journaling": false,
        "actual_hours": 0.008,
        "journaled_at": "2025-12-01T19:30:17.728555Z"
      }
    },
    "task-1-1-4": {
      "type": "subtask",
      "title": "Create ProviderResult and ProviderMetadata dataclasses",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "ProviderResult with content, provider_id, model_used, status, tokens, duration. ProviderMetadata with provider_id, display_name, default_model, capabilities, security_flags",
        "started_at": "2025-12-01T19:30:46.510672Z",
        "status_note": "Creating ProviderResult and ProviderMetadata dataclasses",
        "completed_at": "2025-12-01T19:31:22.764092Z",
        "needs_journaling": false,
        "actual_hours": 0.01,
        "journaled_at": "2025-12-01T19:31:22.768741Z"
      }
    },
    "task-1-1-5": {
      "type": "subtask",
      "title": "Create ProviderContext ABC",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Abstract base class with generate() template method and abstract _execute() method",
        "started_at": "2025-12-01T19:31:56.566554Z",
        "status_note": "Creating ProviderContext ABC",
        "completed_at": "2025-12-01T19:32:57.662535Z",
        "needs_journaling": false,
        "actual_hours": 0.017,
        "journaled_at": "2025-12-01T19:32:57.666517Z"
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "src/foundry_mcp/core/providers/__init__.py",
      "status": "completed",
      "parent": "phase-1-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/__init__.py",
        "task_category": "implementation",
        "estimated_hours": 0.25,
        "description": "Export public API from base.py",
        "started_at": "2025-12-01T19:33:29.096757Z",
        "status_note": "Creating __init__.py for providers package",
        "completed_at": "2025-12-01T19:34:04.667420Z",
        "needs_journaling": false,
        "actual_hours": 0.01,
        "journaled_at": "2025-12-01T19:34:04.671752Z"
      }
    },
    "phase-1-verify": {
      "type": "group",
      "title": "Verification",
      "status": "completed",
      "parent": "phase-1",
      "children": [
        "verify-1-1",
        "verify-1-2"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-1-files"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 2,
      "metadata": {
        "needs_journaling": false,
        "completed_at": "2025-12-01T19:35:41.909238Z",
        "journaled_at": "2025-12-01T19:35:41.917184Z"
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Module imports without errors",
      "status": "completed",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "verification_type": "auto",
        "command": "python -c \"from foundry_mcp.core.providers import ProviderContext, ProviderRequest, ProviderResult, ProviderStatus, ProviderCapability, ProviderMetadata\"",
        "expected": "No import errors",
        "started_at": "2025-12-01T19:34:37.536858Z",
        "status_note": "Running import verification",
        "completed_at": "2025-12-01T19:34:59.726563Z"
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "Type hints and dataclasses are valid",
      "status": "completed",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "verification_type": "auto",
        "command": "PYTHONPATH=src python -m py_compile src/foundry_mcp/core/providers/base.py",
        "expected": "No syntax or type errors",
        "started_at": "2025-12-01T19:35:25.415222Z",
        "status_note": "Running type/syntax verification",
        "completed_at": "2025-12-01T19:35:41.909081Z",
        "needs_journaling": false,
        "actual_hours": 0.005,
        "journaled_at": "2025-12-01T19:35:41.913656Z"
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Detection & Registry System",
      "status": "completed",
      "parent": "spec-root",
      "children": [
        "phase-2-files",
        "phase-2-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-3"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      },
      "total_tasks": 10,
      "completed_tasks": 10,
      "metadata": {
        "purpose": "Implement CLI availability detection and provider registration",
        "risk_level": "low",
        "reference_docs": [
          "docs/mcp_best_practices/04-validation-input-hygiene.md",
          "docs/mcp_best_practices/05-observability-telemetry.md",
          "docs/mcp_best_practices/07-error-semantics.md",
          "docs/mcp_best_practices/08-security-trust-boundaries.md",
          "docs/mcp_best_practices/10-testing-fixtures.md",
          "docs/mcp_best_practices/12-timeout-resilience.md",
          "docs/mcp_best_practices/15-concurrency-patterns.md",
          "docs/guides/testing.md"
        ],
        "needs_journaling": false,
        "completed_at": "2025-12-01T20:56:13.052528Z",
        "journaled_at": "2025-12-01T20:56:13.062988Z"
      }
    },
    "phase-2-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "completed",
      "parent": "phase-2",
      "children": [
        "task-2-0",
        "task-2-1",
        "task-2-2",
        "task-2-3"
      ],
      "total_tasks": 8,
      "completed_tasks": 8,
      "metadata": {
        "needs_journaling": false,
        "completed_at": "2025-12-01T20:24:23.403382Z",
        "journaled_at": "2025-12-01T20:24:23.411689Z"
      },
      "dependencies": {
        "blocks": [
          "phase-2-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-0": {
      "type": "task",
      "title": "Analyze sdd-toolkit detectors.py and registry.py",
      "status": "completed",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-1",
          "task-2-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "task_category": "investigation",
        "estimated_hours": 0.5,
        "description": "Review sdd-toolkit's detectors.py and registry.py patterns",
        "reference_docs": [
          "claude-sdd-toolkit/common/providers/detectors.py (2025-11-25 tag)",
          "claude-sdd-toolkit/common/providers/registry.py (2025-11-25 tag)"
        ],
        "started_at": "2025-12-01T19:51:47.390897Z",
        "status_note": "Starting investigation of sdd-toolkit detector and registry patterns",
        "completed_at": "2025-12-01T19:52:44.732563Z",
        "needs_journaling": false,
        "actual_hours": 0.016,
        "journaled_at": "2025-12-01T19:52:44.751905Z"
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "src/foundry_mcp/core/providers/detectors.py",
      "status": "completed",
      "parent": "phase-2-files",
      "children": [
        "task-2-1-1",
        "task-2-1-2",
        "task-2-1-3",
        "task-2-1-4"
      ],
      "dependencies": {
        "blocks": [
          "task-2-2"
        ],
        "blocked_by": [
          "task-2-0"
        ],
        "depends": []
      },
      "total_tasks": 4,
      "completed_tasks": 4,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/detectors.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "started_at": "2025-12-01T19:53:18.778369Z",
        "status_note": "Starting implementation of detectors.py with ProviderDetector dataclass and registration functions",
        "needs_journaling": false,
        "journaled_at": "2025-12-01T20:13:32.867230Z"
      }
    },
    "task-2-1-1": {
      "type": "subtask",
      "title": "Create ProviderDetector dataclass",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "provider_id, binary_name, probe_args, probe_timeout, binary_env_override fields with resolve_binary() and is_available() methods",
        "completed_at": "2025-12-01T20:23:31.743723Z",
        "needs_journaling": false,
        "journaled_at": "2025-12-01T20:23:31.746476Z"
      }
    },
    "task-2-1-2": {
      "type": "subtask",
      "title": "Create DETECTORS dict with all 5 providers",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Pre-configured detectors for gemini, codex, cursor-agent, claude, opencode with FOUNDRY_ env var prefix",
        "completed_at": "2025-12-01T20:23:55.956324Z",
        "needs_journaling": false,
        "journaled_at": "2025-12-01T20:23:55.958743Z"
      }
    },
    "task-2-1-3": {
      "type": "subtask",
      "title": "Create detection helper functions",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "detect_provider_availability() and get_provider_statuses() functions",
        "completed_at": "2025-12-01T20:23:56.330269Z",
        "needs_journaling": false,
        "journaled_at": "2025-12-01T20:23:56.332769Z"
      }
    },
    "task-2-1-4": {
      "type": "subtask",
      "title": "Add test-mode stubs for detectors",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Introduce FOUNDRY_PROVIDER_TEST_MODE to bypass real CLI probes via mocked subprocess responses for CI safety per docs/guides/testing.md",
        "task_category": "implementation",
        "completed_at": "2025-12-01T20:23:57.102406Z",
        "needs_journaling": false,
        "journaled_at": "2025-12-01T20:23:57.105126Z"
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "src/foundry_mcp/core/providers/registry.py",
      "status": "completed",
      "parent": "phase-2-files",
      "children": [
        "task-2-2-1",
        "task-2-2-2"
      ],
      "dependencies": {
        "blocks": [
          "task-2-3"
        ],
        "blocked_by": [
          "task-2-1",
          "task-2-0"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 2,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/registry.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "started_at": "2025-12-01T20:14:07.800522Z",
        "status_note": "Starting implementation of registry.py with ProviderRegistration dataclass and registration functions",
        "needs_journaling": false,
        "journaled_at": "2025-12-01T20:20:44.295346Z"
      }
    },
    "task-2-2-1": {
      "type": "subtask",
      "title": "Create ProviderRegistration and registry dict",
      "status": "completed",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "ProviderRegistration dataclass with factory, metadata, availability_check. Global _REGISTRY dict.",
        "completed_at": "2025-12-01T20:24:22.704151Z",
        "needs_journaling": false,
        "journaled_at": "2025-12-01T20:24:22.707113Z"
      }
    },
    "task-2-2-2": {
      "type": "subtask",
      "title": "Create registry functions",
      "status": "completed",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "register_provider(), resolve_provider(), available_providers(), check_provider_available() functions",
        "completed_at": "2025-12-01T20:24:23.403219Z",
        "needs_journaling": false,
        "journaled_at": "2025-12-01T20:24:23.406397Z"
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "Update src/foundry_mcp/core/providers/__init__.py",
      "status": "completed",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/__init__.py",
        "task_category": "implementation",
        "estimated_hours": 0.25,
        "description": "Export detectors and registry public APIs",
        "started_at": "2025-12-01T20:21:23.390314Z",
        "status_note": "Updating __init__.py to export detectors and registry public APIs",
        "completed_at": "2025-12-01T20:22:48.195473Z",
        "needs_journaling": false,
        "actual_hours": 0.024,
        "journaled_at": "2025-12-01T20:22:48.199560Z"
      }
    },
    "phase-2-verify": {
      "type": "group",
      "title": "Verification",
      "status": "completed",
      "parent": "phase-2",
      "children": [
        "verify-2-1",
        "verify-2-2"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-2-files"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 2,
      "metadata": {
        "needs_journaling": false,
        "completed_at": "2025-12-01T20:56:13.052524Z",
        "journaled_at": "2025-12-01T20:56:13.061119Z"
      }
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Detector returns correct availability",
      "status": "completed",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "verification_type": "auto",
        "command": "FOUNDRY_PROVIDER_TEST_MODE=1 PYTHONPATH=src python -c \"from foundry_mcp.core.providers import get_provider_statuses; print(get_provider_statuses())\"",
        "expected": "Returns dict mapping provider IDs to boolean availability using mocked probes",
        "started_at": "2025-12-01T20:24:58.855840Z",
        "status_note": "Running automated verification for detector availability",
        "completed_at": "2025-12-01T20:55:23.651830Z",
        "needs_journaling": false,
        "actual_hours": 0.507,
        "journaled_at": "2025-12-01T20:55:23.657215Z"
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "Registry accepts provider registration",
      "status": "completed",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "verification_type": "auto",
        "command": "FOUNDRY_PROVIDER_TEST_MODE=1 PYTHONPATH=src python -c \"from foundry_mcp.core.providers import register_provider, available_providers; print('Registry works')\"",
        "expected": "No errors, registry functions accessible with test-mode registry",
        "started_at": "2025-12-01T20:55:42.954084Z",
        "status_note": "Running automated verification for registry registration",
        "completed_at": "2025-12-01T20:56:13.052362Z",
        "needs_journaling": false,
        "actual_hours": 0.008,
        "journaled_at": "2025-12-01T20:56:13.057319Z"
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "CLI Provider Implementations",
      "status": "in_progress",
      "parent": "spec-root",
      "children": [
        "phase-3-files",
        "phase-3-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-2"
        ],
        "depends": []
      },
      "total_tasks": 20,
      "completed_tasks": 2,
      "metadata": {
        "purpose": "Implement the 5 concrete CLI providers",
        "risk_level": "medium",
        "reference_docs": [
          "docs/mcp_best_practices/04-validation-input-hygiene.md",
          "docs/mcp_best_practices/05-observability-telemetry.md",
          "docs/mcp_best_practices/08-security-trust-boundaries.md",
          "docs/mcp_best_practices/12-timeout-resilience.md",
          "docs/mcp_best_practices/13-tool-discovery.md",
          "docs/mcp_best_practices/15-concurrency-patterns.md"
        ]
      }
    },
    "phase-3-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "in_progress",
      "parent": "phase-3",
      "children": [
        "task-3-0",
        "task-3-1",
        "task-3-2",
        "task-3-3",
        "task-3-4",
        "task-3-5",
        "task-3-6",
        "task-3-7"
      ],
      "total_tasks": 18,
      "completed_tasks": 2,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-3-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-0": {
      "type": "task",
      "title": "Analyze sdd-toolkit provider implementations",
      "status": "completed",
      "parent": "phase-3-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-3-1",
          "task-3-2",
          "task-3-3",
          "task-3-4",
          "task-3-5"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "task_category": "investigation",
        "estimated_hours": 1,
        "description": "Review all 5 provider implementations in sdd-toolkit",
        "reference_docs": [
          "claude-sdd-toolkit/common/providers/gemini.py (2025-11-25 tag)",
          "claude-sdd-toolkit/common/providers/codex.py (2025-11-25 tag)",
          "claude-sdd-toolkit/common/providers/cursor_agent.py (2025-11-25 tag)",
          "claude-sdd-toolkit/common/providers/claude.py (2025-11-25 tag)",
          "claude-sdd-toolkit/common/providers/opencode.py (2025-11-25 tag)"
        ],
        "started_at": "2025-12-01T20:57:53.071580Z",
        "status_note": "Starting analysis of sdd-toolkit provider implementations",
        "completed_at": "2025-12-01T20:58:53.542642Z",
        "needs_journaling": false,
        "actual_hours": 0.017,
        "journaled_at": "2025-12-01T20:58:53.549323Z"
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "src/foundry_mcp/core/providers/gemini.py",
      "status": "completed",
      "parent": "phase-3-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-3-6",
          "task-3-7"
        ],
        "blocked_by": [
          "task-3-0"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/gemini.py",
        "task_category": "implementation",
        "estimated_hours": 1.5,
        "started_at": "2025-12-01T20:59:19.083213Z",
        "status_note": "Starting Gemini provider implementation",
        "completed_at": "2025-12-01T21:00:40.837318Z",
        "needs_journaling": false,
        "actual_hours": 0.023,
        "journaled_at": "2025-12-01T21:00:40.842334Z"
      }
    },
    "task-3-1-1": {
      "type": "subtask",
      "title": "Define GEMINI_METADATA constant",
      "status": "pending",
      "parent": "spec-root",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-3-1-2": {
      "type": "subtask",
      "title": "Implement GeminiProvider class",
      "status": "pending",
      "parent": "spec-root",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Extend ProviderContext, implement _execute() with subprocess call, JSON parsing"
      }
    },
    "task-3-1-3": {
      "type": "subtask",
      "title": "Add factory and auto-registration",
      "status": "pending",
      "parent": "spec-root",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "create_provider() factory function and register_provider() call at module level"
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "src/foundry_mcp/core/providers/codex.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-2-1",
        "task-3-2-2",
        "task-3-2-3"
      ],
      "dependencies": {
        "blocks": [
          "task-3-6",
          "task-3-7"
        ],
        "blocked_by": [
          "task-3-0"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/codex.py",
        "task_category": "implementation",
        "estimated_hours": 1.5
      }
    },
    "task-3-2-1": {
      "type": "subtask",
      "title": "Define CODEX_METADATA constant",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-3-2-2": {
      "type": "subtask",
      "title": "Implement CodexProvider class",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Extend ProviderContext, implement _execute() with --sandbox read-only flag, JSONL parsing"
      }
    },
    "task-3-2-3": {
      "type": "subtask",
      "title": "Add factory and auto-registration",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-3-3": {
      "type": "task",
      "title": "src/foundry_mcp/core/providers/cursor_agent.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-3-1",
        "task-3-3-2",
        "task-3-3-3"
      ],
      "dependencies": {
        "blocks": [
          "task-3-6",
          "task-3-7"
        ],
        "blocked_by": [
          "task-3-0"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/cursor_agent.py",
        "task_category": "implementation",
        "estimated_hours": 1.5
      }
    },
    "task-3-3-1": {
      "type": "subtask",
      "title": "Define CURSOR_METADATA constant",
      "status": "pending",
      "parent": "task-3-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-3-3-2": {
      "type": "subtask",
      "title": "Implement CursorAgentProvider class",
      "status": "pending",
      "parent": "task-3-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Extend ProviderContext, implement _execute() with config file management for read-only"
      }
    },
    "task-3-3-3": {
      "type": "subtask",
      "title": "Add factory and auto-registration",
      "status": "pending",
      "parent": "task-3-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-3-4": {
      "type": "task",
      "title": "src/foundry_mcp/core/providers/claude.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-4-1",
        "task-3-4-2",
        "task-3-4-3"
      ],
      "dependencies": {
        "blocks": [
          "task-3-6",
          "task-3-7"
        ],
        "blocked_by": [
          "task-3-0"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/claude.py",
        "task_category": "implementation",
        "estimated_hours": 1.5
      }
    },
    "task-3-4-1": {
      "type": "subtask",
      "title": "Define CLAUDE_METADATA constant",
      "status": "pending",
      "parent": "task-3-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-3-4-2": {
      "type": "subtask",
      "title": "Implement ClaudeProvider class",
      "status": "pending",
      "parent": "task-3-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Extend ProviderContext, implement _execute() with read-only tool allowlisting"
      }
    },
    "task-3-4-3": {
      "type": "subtask",
      "title": "Add factory and auto-registration",
      "status": "pending",
      "parent": "task-3-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-3-5": {
      "type": "task",
      "title": "src/foundry_mcp/core/providers/opencode.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-5-1",
        "task-3-5-2",
        "task-3-5-3"
      ],
      "dependencies": {
        "blocks": [
          "task-3-6",
          "task-3-7"
        ],
        "blocked_by": [
          "task-3-0"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/opencode.py",
        "task_category": "implementation",
        "estimated_hours": 1.5
      }
    },
    "task-3-5-1": {
      "type": "subtask",
      "title": "Define OPENCODE_METADATA constant",
      "status": "pending",
      "parent": "task-3-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-3-5-2": {
      "type": "subtask",
      "title": "Implement OpenCodeProvider class",
      "status": "pending",
      "parent": "task-3-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Extend ProviderContext, implement _execute() with Node.js wrapper handling"
      }
    },
    "task-3-5-3": {
      "type": "subtask",
      "title": "Add factory and auto-registration",
      "status": "pending",
      "parent": "task-3-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-3-6": {
      "type": "task",
      "title": "Update src/foundry_mcp/core/providers/__init__.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-3-1",
          "task-3-2",
          "task-3-3",
          "task-3-4",
          "task-3-5",
          "task-3-7"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/core/providers/__init__.py",
        "task_category": "implementation",
        "estimated_hours": 0.25,
        "description": "Import provider modules to trigger auto-registration"
      }
    },
    "task-3-7": {
      "type": "task",
      "title": "Cross-provider validation & resilience hooks",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-7-1",
        "task-3-7-2",
        "task-3-7-3"
      ],
      "dependencies": {
        "blocks": [
          "phase-3-verify",
          "task-3-6"
        ],
        "blocked_by": [
          "task-3-1",
          "task-3-2",
          "task-3-3",
          "task-3-4",
          "task-3-5"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "estimated_hours": 1.5,
        "description": "Centralize ProviderRequest validation, observability hooks, and rate limiting consistent with docs/mcp_best_practices/{04,05,12,15}.",
        "file_path": "task-3-7.py"
      }
    },
    "task-3-7-1": {
      "type": "subtask",
      "title": "Input hygiene & allowlists",
      "status": "pending",
      "parent": "task-3-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Validate prompts/metadata, enforce UTF-8, strip ANSI, and block disallowed flags before subprocess exec per docs/mcp_best_practices/04-validation-input-hygiene.md."
      }
    },
    "task-3-7-2": {
      "type": "subtask",
      "title": "Structured logging & metrics",
      "status": "pending",
      "parent": "task-3-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Emit provider execution spans w/ correlation IDs, timings, and ProviderStatus mapping via shared telemetry helpers (docs/mcp_best_practices/05-observability-telemetry.md)."
      }
    },
    "task-3-7-3": {
      "type": "subtask",
      "title": "Timeout budgets & retries",
      "status": "pending",
      "parent": "task-3-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Wire ProviderContext to CircuitBreaker + concurrency limits, configure retry matrix per ProviderStatus.is_retryable() with docs/mcp_best_practices/12-timeout-resilience.md and 15-concurrency-patterns.md."
      }
    },
    "phase-3-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "verify-3-1",
        "verify-3-2"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-3-files",
          "task-3-7"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-3-1": {
      "type": "verify",
      "title": "All providers register successfully",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "FOUNDRY_PROVIDER_TEST_MODE=1 PYTHONPATH=src python -c \"from foundry_mcp.core.providers import available_providers; providers = available_providers(); print(f'Registered: {list(providers.keys())}')\"",
        "expected": "Shows registered providers via mocked availability"
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "Provider can be resolved and instantiated",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "FOUNDRY_PROVIDER_TEST_MODE=1 PYTHONPATH=src python -c \"from foundry_mcp.core.providers import resolve_provider, check_provider_available; pid='gemini'; print(f'{pid} available: {check_provider_available(pid)}')\"",
        "expected": "Shows availability status using mocked detectors without errors"
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "MCP Tool Exposure",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-4-files",
        "phase-4-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-5"
        ],
        "blocked_by": [
          "phase-3"
        ],
        "depends": []
      },
      "total_tasks": 11,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Create MCP tools for provider access",
        "risk_level": "low",
        "reference_docs": [
          "docs/mcp_best_practices/01-versioned-contracts.md",
          "docs/mcp_best_practices/02-envelopes-metadata.md",
          "docs/mcp_best_practices/03-serialization-helpers.md",
          "docs/mcp_best_practices/11-ai-llm-integration.md",
          "docs/mcp_best_practices/13-tool-discovery.md",
          "docs/codebase_standards/cli-output.md",
          "docs/codebase_standards/naming-conventions.md",
          "docs/cli_best_practices/README.md"
        ]
      }
    },
    "phase-4-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-1",
        "task-4-2",
        "task-4-3"
      ],
      "total_tasks": 9,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-4-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "src/foundry_mcp/tools/providers.py",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [
        "task-4-1-1",
        "task-4-1-2",
        "task-4-1-3",
        "task-4-1-4",
        "task-4-1-5"
      ],
      "dependencies": {
        "blocks": [
          "task-4-2",
          "task-4-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/providers.py",
        "task_category": "implementation",
        "estimated_hours": 2
      }
    },
    "task-4-1-1": {
      "type": "subtask",
      "title": "Create register_provider_tools() function",
      "status": "pending",
      "parent": "task-4-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Main registration function following foundry-mcp pattern"
      }
    },
    "task-4-1-2": {
      "type": "subtask",
      "title": "Implement provider_list tool",
      "status": "pending",
      "parent": "task-4-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "List all CLI providers with availability status using success_response() per docs/mcp_best_practices/02-envelopes-metadata.md and 03-serialization-helpers.md"
      }
    },
    "task-4-1-3": {
      "type": "subtask",
      "title": "Implement provider_status tool",
      "status": "pending",
      "parent": "task-4-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Get detailed status for specific provider with error_response() for not found, following docs/mcp_best_practices/02-envelopes-metadata.md and 03-serialization-helpers.md"
      }
    },
    "task-4-1-4": {
      "type": "subtask",
      "title": "Implement provider_execute tool",
      "status": "pending",
      "parent": "task-4-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Execute prompt against provider with CircuitBreaker integration, ProviderRequest validation, and trust-boundary enforcement (docs/mcp_best_practices/01-versioned-contracts.md, 02-envelopes-metadata.md, 03-serialization-helpers.md, 04 & 08)."
      }
    },
    "task-4-1-5": {
      "type": "subtask",
      "title": "Tool metadata & discovery schema",
      "status": "pending",
      "parent": "task-4-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Annotate provider tools with discovery tags, rate limits, and usage examples aligned with docs/mcp_best_practices/13-tool-discovery.md and docs/codebase_standards/naming-conventions.md."
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Update src/foundry_mcp/server.py",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-4-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/server.py",
        "task_category": "implementation",
        "estimated_hours": 0.25,
        "description": "Register provider tools in server initialization"
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "Docs & capabilities sync",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [
        "task-4-3-1",
        "task-4-3-2",
        "task-4-3-3"
      ],
      "dependencies": {
        "blocks": [
          "phase-4-verify"
        ],
        "blocked_by": [
          "task-4-1"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "estimated_hours": 1,
        "description": "Keep docs, manifests, and discovery metadata in lockstep with new tools per docs/mcp_best_practices/09 and 13.",
        "file_path": "task-4-3.py"
      }
    },
    "task-4-3-1": {
      "type": "subtask",
      "title": "Update CLI + MCP docs",
      "status": "pending",
      "parent": "task-4-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "docs/cli_best_practices/README.md",
        "description": "Document provider-list/status/execute usage, JSON envelopes, and safety notes referencing docs/codebase_standards/cli-output.md and docs/codebase_standards/naming-conventions.md."
      }
    },
    "task-4-3-2": {
      "type": "subtask",
      "title": "Update capabilities manifests",
      "status": "pending",
      "parent": "task-4-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "mcp/capabilities_manifest.json",
        "description": "Expose provider tools, tags, rate limits, and discovery metadata; reflect same in samples/foundry-mcp.toml."
      }
    },
    "task-4-3-3": {
      "type": "subtask",
      "title": "Regenerate generated docs",
      "status": "pending",
      "parent": "task-4-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "docs/generated/index.md",
        "description": "Run doc-generation pipeline so architecture + inventory outputs describe provider abstraction changes (docs/mcp_best_practices/10-testing-fixtures.md)."
      }
    },
    "phase-4-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "verify-4-1",
        "verify-4-2"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-4-files",
          "task-4-3"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-4-1": {
      "type": "verify",
      "title": "MCP tools are registered",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "description": "Check server exposes provider-list, provider-status, provider-execute tools with discovery metadata per docs/mcp_best_practices/13-tool-discovery.md"
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "Response envelope compliance",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "description": "Verify all tool responses follow response-v2 envelope format with success/error/meta fields per docs/codebase_standards/mcp_response_schema.md"
      }
    },
    "phase-5": {
      "type": "phase",
      "title": "Review Integration & Refactoring",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-5-files",
        "phase-5-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-6"
        ],
        "blocked_by": [
          "phase-4"
        ],
        "depends": []
      },
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Refactor review.py to use new provider abstraction",
        "risk_level": "medium",
        "reference_docs": [
          "docs/mcp_best_practices/04-validation-input-hygiene.md",
          "docs/mcp_best_practices/09-spec-driven-development.md",
          "docs/mcp_best_practices/10-testing-fixtures.md",
          "docs/mcp_best_practices/14-feature-flags.md",
          "docs/codebase_standards/mcp_response_schema.md"
        ]
      }
    },
    "phase-5-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-5",
      "children": [
        "task-5-1"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-5-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-1": {
      "type": "task",
      "title": "src/foundry_mcp/tools/review.py",
      "status": "pending",
      "parent": "phase-5-files",
      "children": [
        "task-5-1-1",
        "task-5-1-2",
        "task-5-1-3",
        "task-5-1-4"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/review.py",
        "task_category": "refactoring",
        "estimated_hours": 2
      }
    },
    "task-5-1-1": {
      "type": "subtask",
      "title": "Replace REVIEW_TOOLS list with provider imports",
      "status": "pending",
      "parent": "task-5-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Import get_provider_statuses, available_providers from core.providers"
      }
    },
    "task-5-1-2": {
      "type": "subtask",
      "title": "Refactor review_list_tools to use provider system",
      "status": "pending",
      "parent": "task-5-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Replace raw subprocess version checks with get_provider_statuses()"
      }
    },
    "task-5-1-3": {
      "type": "subtask",
      "title": "Remove redundant subprocess calls",
      "status": "pending",
      "parent": "task-5-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Clean up any remaining raw subprocess tool invocations that are now handled by providers"
      }
    },
    "task-5-1-4": {
      "type": "subtask",
      "title": "Introduce review-provider feature flag",
      "status": "pending",
      "parent": "task-5-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add feature flag + rollout plan (docs/mcp_best_practices/14-feature-flags.md) with flag lifecycle notes and fallback path to legacy subprocess behavior."
      }
    },
    "phase-5-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-5",
      "children": [
        "verify-5-1",
        "verify-5-2"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-5-files"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-5-1": {
      "type": "verify",
      "title": "review-list-tools returns same data format",
      "status": "pending",
      "parent": "phase-5-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "description": "Ensure backward compatibility - response structure unchanged"
      }
    },
    "verify-5-2": {
      "type": "verify",
      "title": "Existing review functionality unaffected",
      "status": "pending",
      "parent": "phase-5-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "PYTHONPATH=src pytest tests/unit/test_review.py -v",
        "expected": "All existing review tests pass"
      }
    },
    "phase-6": {
      "type": "phase",
      "title": "Testing & Verification",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-6-files",
        "phase-6-verify"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-5"
        ],
        "depends": []
      },
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Comprehensive testing for all new components",
        "risk_level": "low",
        "reference_docs": [
          "docs/mcp_best_practices/09-spec-driven-development.md",
          "docs/mcp_best_practices/10-testing-fixtures.md",
          "docs/mcp_best_practices/12-timeout-resilience.md",
          "docs/guides/testing.md"
        ]
      }
    },
    "phase-6-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-6",
      "children": [
        "task-6-1",
        "task-6-2",
        "task-6-3",
        "task-6-4",
        "task-6-5",
        "task-6-6"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-6-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-1": {
      "type": "task",
      "title": "tests/unit/test_providers_base.py",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-6-6"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/unit/test_providers_base.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "description": "Test ProviderStatus.is_retryable(), to_error_type(), dataclass creation"
      }
    },
    "task-6-2": {
      "type": "task",
      "title": "tests/unit/test_providers_detectors.py",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-6-6"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/unit/test_providers_detectors.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "description": "Test ProviderDetector PATH resolution, probe execution, env overrides"
      }
    },
    "task-6-3": {
      "type": "task",
      "title": "tests/unit/test_providers_registry.py",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-6-6"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/unit/test_providers_registry.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "description": "Test register_provider, resolve_provider, available_providers functions"
      }
    },
    "task-6-4": {
      "type": "task",
      "title": "tests/unit/test_providers_implementations.py",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-6-6"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/unit/test_providers_implementations.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "description": "Test each provider with mocked subprocess calls"
      }
    },
    "task-6-5": {
      "type": "task",
      "title": "tests/integration/test_provider_tools.py",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-6-6"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/integration/test_provider_tools.py",
        "task_category": "implementation",
        "estimated_hours": 1.5,
        "description": "Test MCP tools with mock server"
      }
    },
    "task-6-6": {
      "type": "task",
      "title": "Regenerate provider fixtures",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-6-1",
          "task-6-2",
          "task-6-3",
          "task-6-4",
          "task-6-5"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/fixtures/golden",
        "task_category": "implementation",
        "estimated_hours": 0.5,
        "description": "Update golden fixtures + doc-generation state to reflect provider outputs per docs/mcp_best_practices/10-testing-fixtures.md"
      }
    },
    "phase-6-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-6",
      "children": [
        "verify-6-1",
        "verify-6-2"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-6-files"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-6-1": {
      "type": "verify",
      "title": "All new tests pass",
      "status": "pending",
      "parent": "phase-6-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "FOUNDRY_PROVIDER_TEST_MODE=1 PYTHONPATH=src pytest tests/unit/test_providers*.py tests/integration/test_provider_tools.py -v",
        "expected": "All tests pass using mocked provider binaries"
      }
    },
    "verify-6-2": {
      "type": "verify",
      "title": "Full test suite passes",
      "status": "pending",
      "parent": "phase-6-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "FOUNDRY_PROVIDER_TEST_MODE=1 PYTHONPATH=src pytest tests/ -v --ignore=tests/parity",
        "expected": "No regressions - all existing tests still pass"
      }
    }
  },
  "metadata": {
    "status": "active",
    "activated_date": "2025-12-01T15:49:52.907043Z",
    "progress_percentage": 31,
    "current_phase": "phase-3"
  },
  "journal": [
    {
      "timestamp": "2025-12-01T19:26:07.928418Z",
      "entry_type": "status_change",
      "title": "Task Completed: Analyze sdd-toolkit provider base.py",
      "author": "claude-code",
      "content": "Analyzed sdd-toolkit provider base.py at claude_skills/common/providers/base.py. Key components documented: (1) Enums: ProviderCapability (5 values), ProviderStatus (6 values with is_retryable() method); (2) Error hierarchy: ProviderError base with UnavailableError, ExecutionError, TimeoutError subclasses; (3) Frozen dataclasses: TokenUsage, ModelDescriptor, ProviderMetadata, GenerationRequest, StreamChunk, GenerationResult; (4) Hook system: StreamCallback, BeforeExecuteHook, AfterResultHook types plus ProviderHooks dataclass; (5) ProviderContext ABC with generate(), _execute() abstract method, _prepare_request() hook, and supports() capability check. Adaptations for foundry-mcp noted: place under core/providers/, align with responses.py patterns, integrate error hierarchy with existing patterns.",
      "metadata": {},
      "task_id": "task-1-0"
    },
    {
      "timestamp": "2025-12-01T19:27:11.854070Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create ProviderCapability enum",
      "author": "claude-code",
      "content": "Created ProviderCapability enum in src/foundry_mcp/core/providers/base.py with 5 capability values: TEXT (text_generation), VISION, FUNCTION_CALLING, STREAMING, THINKING. File created with module docstring explaining design principles (frozen dataclasses, enum capabilities, status alignment, error hierarchy). Enum includes comprehensive docstring documenting each capability value.",
      "metadata": {},
      "task_id": "task-1-1-1"
    },
    {
      "timestamp": "2025-12-01T19:29:17.470848Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create ProviderStatus enum with to_error_type()",
      "author": "claude-code",
      "content": "Added ProviderStatus enum to base.py with 6 values: SUCCESS, TIMEOUT, NOT_FOUND, INVALID_OUTPUT, ERROR, CANCELED. Implemented is_retryable() method (TIMEOUT and ERROR are retryable). Implemented to_error_type() method that maps to foundry-mcp ErrorType enum: TIMEOUT->UNAVAILABLE, NOT_FOUND->NOT_FOUND, INVALID_OUTPUT->VALIDATION, ERROR->INTERNAL, CANCELED->INTERNAL. Used TYPE_CHECKING import to avoid circular dependency with responses.py.",
      "metadata": {},
      "task_id": "task-1-1-2"
    },
    {
      "timestamp": "2025-12-01T19:30:17.728545Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create ProviderRequest dataclass",
      "author": "claude-code",
      "content": "Added frozen ProviderRequest dataclass to base.py with fields: prompt (required str), system_prompt (optional str), model (optional str), timeout (optional float), temperature (optional float), max_tokens (optional int), metadata (dict), stream (bool default False), attachments (sequence of str). Includes comprehensive docstring documenting each field's purpose and common values.",
      "metadata": {},
      "task_id": "task-1-1-3"
    },
    {
      "timestamp": "2025-12-01T19:31:22.768736Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create ProviderResult and ProviderMetadata dataclasses",
      "author": "claude-code",
      "content": "Added 4 frozen dataclasses to base.py: (1) TokenUsage with input_tokens, output_tokens, cached_input_tokens, total_tokens fields; (2) ProviderResult with content, provider_id, model_used, status, tokens, duration_ms, stderr, raw_payload fields; (3) ModelDescriptor with id, display_name, capabilities, routing_hints fields; (4) ProviderMetadata with provider_id, display_name, models, default_model, capabilities, security_flags, extra fields. All include comprehensive docstrings.",
      "metadata": {},
      "task_id": "task-1-1-4"
    },
    {
      "timestamp": "2025-12-01T19:32:57.666512Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create ProviderContext ABC",
      "author": "claude-code",
      "content": "Added ProviderContext ABC to base.py with: (1) Error hierarchy: ProviderError base, ProviderUnavailableError, ProviderExecutionError, ProviderTimeoutError; (2) Hook system: StreamChunk dataclass, ProviderHooks dataclass with emit_before/emit_stream/emit_after methods, type aliases StreamChunkCallback, BeforeExecuteHook, AfterResultHook; (3) ProviderContext ABC with __init__(metadata, hooks), metadata property, supports(capability), generate() template method with lifecycle hooks and error normalization, _prepare_request() hook, _emit_stream_chunk() helper, abstract _execute() method; (4) Comprehensive __all__ exports list.",
      "metadata": {},
      "task_id": "task-1-1-5"
    },
    {
      "timestamp": "2025-12-01T19:34:04.671739Z",
      "entry_type": "status_change",
      "title": "Task Completed: src/foundry_mcp/core/providers/__init__.py",
      "author": "claude-code",
      "content": "Created src/foundry_mcp/core/providers/__init__.py exporting full public API from base.py: ProviderCapability, ProviderStatus (enums); ProviderRequest, ProviderResult, TokenUsage, StreamChunk (request/response); ModelDescriptor, ProviderMetadata (metadata); ProviderHooks, StreamChunkCallback, BeforeExecuteHook, AfterResultHook (hooks); ProviderError, ProviderUnavailableError, ProviderExecutionError, ProviderTimeoutError (errors); ProviderContext (ABC). Includes module docstring with example usage. Verified imports work correctly.",
      "metadata": {},
      "task_id": "task-1-2"
    },
    {
      "timestamp": "2025-12-01T19:34:04.675397Z",
      "entry_type": "status_change",
      "title": "Group Completed: File Modifications",
      "author": "claude-code",
      "content": "All child tasks in group phase-1-files have been completed.",
      "metadata": {},
      "task_id": "phase-1-files"
    },
    {
      "timestamp": "2025-12-01T19:34:59.726563Z",
      "task_id": "verify-1-1",
      "entry_type": "status_change",
      "title": "Task Completed: Module imports without errors",
      "content": "Verification PASSED. Ran command: python -c \"from foundry_mcp.core.providers import ProviderContext, ProviderRequest, ProviderResult, ProviderStatus, ProviderCapability, ProviderMetadata\". All imports successful with no errors.",
      "author": "foundry-mcp"
    },
    {
      "timestamp": "2025-12-01T19:35:41.913648Z",
      "entry_type": "status_change",
      "title": "Task Completed: Type hints and dataclasses are valid",
      "author": "claude-code",
      "content": "Verification PASSED. Ran command: PYTHONPATH=src python -m py_compile src/foundry_mcp/core/providers/base.py. No syntax or type errors found. This completes Phase 1: Core Provider Abstractions.",
      "metadata": {},
      "task_id": "verify-1-2"
    },
    {
      "timestamp": "2025-12-01T19:35:41.917180Z",
      "entry_type": "status_change",
      "title": "Group Completed: Verification",
      "author": "claude-code",
      "content": "All child tasks in group phase-1-verify have been completed.",
      "metadata": {},
      "task_id": "phase-1-verify"
    },
    {
      "timestamp": "2025-12-01T19:35:41.918864Z",
      "entry_type": "status_change",
      "title": "Phase Completed: Core Provider Abstractions",
      "author": "claude-code",
      "content": "All child tasks in phase phase-1 have been completed.",
      "metadata": {},
      "task_id": "phase-1"
    },
    {
      "timestamp": "2025-12-01T19:52:44.751884Z",
      "entry_type": "status_change",
      "title": "Task Completed: Analyze sdd-toolkit detectors.py and registry.py",
      "author": "claude-code",
      "content": "Analyzed sdd-toolkit detectors.py and registry.py patterns. Key findings: (1) detectors.py uses frozen ProviderDetector dataclass with PATH resolution via shutil.which(), env var overrides, and subprocess health probes; maintains global _DETECTORS dict with register/get/iterate functions. (2) registry.py uses ProviderRegistration dataclass supporting lazy loading, metadata resolvers, availability checks, priority, and tags; provides register_provider(), register_lazy_provider(), resolve_provider(), available_providers() APIs. foundry-mcp base.py already exists with all core types. Next tasks (task-2-1, task-2-2) will implement adapted versions of these patterns.",
      "metadata": {},
      "task_id": "task-2-0"
    },
    {
      "timestamp": "2025-12-01T20:13:32.867218Z",
      "entry_type": "status_change",
      "title": "Task Completed: src/foundry_mcp/core/providers/detectors.py",
      "author": "claude-code",
      "content": "Created src/foundry_mcp/core/providers/detectors.py with: (1) ProviderDetector frozen dataclass with provider_id, binary_name, probe_args, probe_timeout, binary_env_override fields plus resolve_binary() and is_available() methods; (2) Default _DETECTORS dict with 5 providers (gemini, codex, cursor-agent, claude, opencode) using FOUNDRY_ prefix env vars; (3) Public API functions detect_provider_availability(), get_provider_statuses(), register_detector(), get_detector(), list_detectors(), reset_detectors(); (4) FOUNDRY_PROVIDER_TEST_MODE env var for CI-safe testing that bypasses real CLI probes. All manual tests pass. Committed as 68df0d4.",
      "metadata": {},
      "task_id": "task-2-1"
    },
    {
      "timestamp": "2025-12-01T20:20:44.295335Z",
      "entry_type": "status_change",
      "title": "Task Completed: src/foundry_mcp/core/providers/registry.py",
      "author": "claude-code",
      "content": "Created src/foundry_mcp/core/providers/registry.py with: (1) ProviderRegistration dataclass supporting factory, lazy_loader, metadata, metadata_resolver, availability_check, priority, description, tags fields; (2) ProviderFactory Protocol for type-safe factory signatures; (3) Public API: register_provider(), register_lazy_provider(), available_providers(), check_provider_available(), resolve_provider(), get_provider_metadata(), describe_providers(), set_dependency_resolver(), reset_registry(), get_registration(). All manual tests pass with mock provider integration. Committed as 342d3b7.",
      "metadata": {},
      "task_id": "task-2-2"
    },
    {
      "timestamp": "2025-12-01T20:22:48.199554Z",
      "entry_type": "status_change",
      "title": "Task Completed: Update src/foundry_mcp/core/providers/__init__.py",
      "author": "claude-code",
      "content": "Updated src/foundry_mcp/core/providers/__init__.py to export all public APIs from detectors.py and registry.py. Exports organized in three sections: (1) Base Types - existing ProviderCapability, ProviderStatus, etc.; (2) Detection - ProviderDetector, detect_provider_availability, get_provider_statuses, etc.; (3) Registry - ProviderFactory, register_provider, resolve_provider, available_providers, etc. Updated docstring with comprehensive usage example. All imports verified working. Committed as 432fed4.",
      "metadata": {},
      "task_id": "task-2-3"
    },
    {
      "timestamp": "2025-12-01T20:23:31.746466Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create ProviderDetector dataclass",
      "author": "claude-code",
      "content": "Already completed as part of task-2-1 (parent task). ProviderDetector frozen dataclass implemented with provider_id, binary_name, probe_args, probe_timeout, binary_env fields plus resolve_binary() and is_available() methods. See commit 68df0d4.",
      "metadata": {},
      "task_id": "task-2-1-1"
    },
    {
      "timestamp": "2025-12-01T20:23:55.958738Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create DETECTORS dict with all 5 providers",
      "author": "claude-code",
      "content": "Already completed as part of task-2-1 (parent task). Default _DETECTORS dict created with 5 pre-configured providers (gemini, codex, cursor-agent, claude, opencode) using FOUNDRY_ prefix for env vars. See commit 68df0d4.",
      "metadata": {},
      "task_id": "task-2-1-2"
    },
    {
      "timestamp": "2025-12-01T20:23:56.332761Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create detection helper functions",
      "author": "claude-code",
      "content": "Already completed as part of parent task task-2-1. Detection helper functions implemented: detect_provider_availability(), get_provider_statuses(), register_detector(), get_detector(), list_detectors(), reset_detectors(). Implementation reference: commit 68df0d4.",
      "metadata": {},
      "task_id": "task-2-1-3"
    },
    {
      "timestamp": "2025-12-01T20:23:57.105116Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add test-mode stubs for detectors",
      "author": "claude-code",
      "content": "Already completed as part of task-2-1 (parent task). FOUNDRY_PROVIDER_TEST_MODE env var implemented to bypass real CLI probes for CI safety. When enabled, is_available() returns False unless overridden by provider-specific env var. See commit 68df0d4.",
      "metadata": {},
      "task_id": "task-2-1-4"
    },
    {
      "timestamp": "2025-12-01T20:24:22.707103Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create ProviderRegistration and registry dict",
      "author": "claude-code",
      "content": "Already completed as part of task-2-2 (parent task). ProviderRegistration dataclass implemented with factory, lazy_loader, metadata, metadata_resolver, availability_check, priority, description, tags fields. Global _REGISTRY dict created. See commit 342d3b7.",
      "metadata": {},
      "task_id": "task-2-2-1"
    },
    {
      "timestamp": "2025-12-01T20:24:23.406385Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create registry functions",
      "author": "claude-code",
      "content": "Already completed as part of task-2-2 (parent task). Registry functions implemented: register_provider(), register_lazy_provider(), resolve_provider(), available_providers(), check_provider_available(), get_provider_metadata(), describe_providers(), set_dependency_resolver(), reset_registry(), get_registration(). See commit 342d3b7.",
      "metadata": {},
      "task_id": "task-2-2-2"
    },
    {
      "timestamp": "2025-12-01T20:24:23.411674Z",
      "entry_type": "status_change",
      "title": "Group Completed: File Modifications",
      "author": "claude-code",
      "content": "All child tasks in group phase-2-files have been completed.",
      "metadata": {},
      "task_id": "phase-2-files"
    },
    {
      "timestamp": "2025-12-01T20:55:23.657208Z",
      "entry_type": "status_change",
      "title": "Task Completed: Detector returns correct availability",
      "author": "claude-code",
      "content": "Verification PASSED. Test mode (FOUNDRY_PROVIDER_TEST_MODE=1) correctly returns all providers as unavailable: {'gemini': False, 'codex': False, 'cursor-agent': False, 'claude': False, 'opencode': False}. Override mechanism verified - setting FOUNDRY_GEMINI_AVAILABLE_OVERRIDE=true correctly makes gemini available while others remain unavailable. Detector returns correct dict mapping provider IDs to boolean availability using test mode bypass.",
      "metadata": {},
      "task_id": "verify-2-1"
    },
    {
      "timestamp": "2025-12-01T20:56:13.057313Z",
      "entry_type": "status_change",
      "title": "Task Completed: Registry accepts provider registration",
      "author": "claude-code",
      "content": "Verification PASSED. Registry functions accessible in test mode. Comprehensive test verified: (1) reset_registry() clears all providers, (2) register_provider() adds provider to registry, (3) available_providers() returns registered provider, (4) check_provider_available() returns True for registered provider with availability_check. No errors encountered.",
      "metadata": {},
      "task_id": "verify-2-2"
    },
    {
      "timestamp": "2025-12-01T20:56:13.061114Z",
      "entry_type": "status_change",
      "title": "Group Completed: Verification",
      "author": "claude-code",
      "content": "All child tasks in group phase-2-verify have been completed.",
      "metadata": {},
      "task_id": "phase-2-verify"
    },
    {
      "timestamp": "2025-12-01T20:56:13.062984Z",
      "entry_type": "status_change",
      "title": "Phase Completed: Detection & Registry System",
      "author": "claude-code",
      "content": "All child tasks in phase phase-2 have been completed.",
      "metadata": {},
      "task_id": "phase-2"
    },
    {
      "timestamp": "2025-12-01T20:58:53.549309Z",
      "entry_type": "status_change",
      "title": "Task Completed: Analyze sdd-toolkit provider implementations",
      "author": "claude-code",
      "content": "Analyzed all 5 sdd-toolkit provider implementations (gemini.py, codex.py, cursor_agent.py, claude.py, opencode.py). Found key differences requiring adaptation:\n\n1. **Class/Type mappings**:\n   - sdd-toolkit `GenerationRequest` \u2192 foundry-mcp `ProviderRequest`\n   - sdd-toolkit `GenerationResult` \u2192 foundry-mcp `ProviderResult`\n   - sdd-toolkit `provider_name` \u2192 foundry-mcp `provider_id`\n\n2. **Common patterns across all providers**:\n   - RunnerProtocol for subprocess injection (testing)\n   - ALLOWED_TOOLS lists for read-only enforcement\n   - Security warnings in system prompts\n   - ModelDescriptor with ProviderCapability enums\n   - create_provider factory with hooks/dependencies/overrides signature\n   - is_*_available() availability check functions\n   - register_provider() call at module load\n\n3. **Provider-specific patterns**:\n   - gemini: --allowed-tools CLI flags, JSON output format\n   - codex: --sandbox read-only mode (OS-level), JSONL output parsing\n   - cursor-agent: Config file manipulation (~/.cursor/cli-config.json), backup/restore logic\n   - claude: --allowed-tools and --disallowed-tools flags, --print mode\n   - opencode: Node.js wrapper script, server startup/management, temp config files\n\n4. **foundry-mcp infrastructure is ready**:\n   - detectors.py already has ProviderDetector for all 5 providers\n   - registry.py has full registration system\n   - base.py has all required types (ProviderRequest, ProviderResult, etc.)\n\n5. **Implementation strategy for tasks 3-1 through 3-5**:\n   - Adapt each sdd-toolkit provider to use foundry-mcp base types\n   - Use detect_provider_availability() from detectors.py\n   - Keep CLI invocation logic intact, just update type imports",
      "metadata": {},
      "task_id": "task-3-0"
    },
    {
      "timestamp": "2025-12-01T21:00:40.842321Z",
      "entry_type": "status_change",
      "title": "Task Completed: src/foundry_mcp/core/providers/gemini.py",
      "author": "claude-code",
      "content": "Created src/foundry_mcp/core/providers/gemini.py with full Gemini CLI provider implementation. Adapted from sdd-toolkit version with foundry-mcp base types (ProviderRequest, ProviderResult, provider_id). Includes: GeminiProvider class extending ProviderContext, GEMINI_MODELS with 3 model descriptors, GEMINI_METADATA, ALLOWED_TOOLS list for read-only enforcement, RunnerProtocol for testing, create_provider factory, is_gemini_available check, and automatic registration. Verified imports work correctly.",
      "metadata": {},
      "task_id": "task-3-1"
    }
  ]
}