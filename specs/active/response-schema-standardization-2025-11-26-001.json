{
  "spec_id": "response-schema-standardization-2025-11-26-001",
  "title": "MCP Tool Response Schema Standardization",
  "generated": "2025-11-26T12:00:00Z",
  "last_updated": "2025-11-26T19:42:12.935438Z",
  "metadata": {
    "description": "Standardize all MCP tool response schemas across six tool modules plus new core helpers so every client sees the same predictable envelope.",
    "objectives": [
      "All tools return consistent {success: bool, data: {...}, error: ...} structure",
      "Eliminate mixed patterns (found vs success vs none)",
      "Uniform error handling across all tools",
      "Enable predictable client parsing without tool-specific branching"
    ],
    "complexity": "medium",
    "estimated_hours": 12,
    "response_contract": {
      "required_fields": {
        "success": "Boolean indicator present on every response.",
        "data": "Object payload; defaults to {} when no payload is returned.",
        "error": "Nullable string; null whenever success is true.",
        "meta": "Optional object for pagination, warnings, and response contract metadata (e.g., version)."
      },
      "serialization_rules": [
        "Always emit success/data/error keys regardless of branch.",
        "When success is false, data MUST be {} unless partial payload is explicitly documented.",
        "When success is true, error MUST be null and meta.version MUST equal 'response-v2'."
      ],
      "examples": [
        "{\"success\": true, \"data\": {\"tasks\": []}, \"error\": null, \"meta\": {\"version\": \"response-v2\"}}",
        "{\"success\": false, \"data\": {}, \"error\": \"Task not found\", \"meta\": {\"version\": \"response-v2\", \"retryable\": false}}"
      ]
    },
    "rollout_plan": {
      "feature_flag": "response_contract_v2",
      "migration_steps": [
        "Ship helpers in foundry_mcp.core.responses and guard tool usage behind response_contract_v2 flag.",
        "Emit dual responses when clients pass response_contract=v2 capability header for one release.",
        "Flip server default after telemetry shows 95% of requests opt into v2 for 7 consecutive days."
      ]
    },
    "assumptions": [
      "Backward compatibility is enforced via response_contract_v2 flag until rollout completion",
      "schema_version field will be removed for consistency once telemetry threshold is met",
      "Response wrapper utility will be added to core module",
      "Clients advertise response_contract version via MCP capability negotiation"
    ],
    "progress_percentage": 46,
    "status": "active",
    "current_phase": "phase-2"
  },
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "MCP Tool Response Schema Standardization",
      "status": "in_progress",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4"
      ],
      "total_tasks": 30,
      "completed_tasks": 14,
      "metadata": {}
    },
    "phase-1": {
      "type": "phase",
      "title": "Define Standard Response Contract",
      "status": "completed",
      "parent": "spec-root",
      "children": [
        "phase-1-files",
        "phase-1-verify"
      ],
      "total_tasks": 8,
      "completed_tasks": 8,
      "metadata": {
        "purpose": "Create the canonical response schema and helper utilities",
        "risk_level": "low",
        "estimated_hours": 2,
        "needs_journaling": false,
        "completed_at": "2025-11-26T19:35:38.249438Z",
        "journaled_at": "2025-11-26T19:35:38.255065Z"
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "completed",
      "parent": "phase-1",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3"
      ],
      "total_tasks": 6,
      "completed_tasks": 6,
      "metadata": {
        "needs_journaling": false,
        "completed_at": "2025-11-26T19:34:03.970270Z",
        "journaled_at": "2025-11-26T19:34:03.975804Z"
      },
      "dependencies": {
        "blocks": [
          "phase-1-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "src/foundry_mcp/core/responses.py",
      "status": "completed",
      "parent": "phase-1-files",
      "children": [
        "task-1-1-1",
        "task-1-1-2",
        "task-1-1-3",
        "task-1-1-4"
      ],
      "total_tasks": 4,
      "completed_tasks": 4,
      "metadata": {
        "file_path": "src/foundry_mcp/core/responses.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Create new module for standardized response handling"
      },
      "dependencies": {
        "blocks": [
          "task-1-2",
          "task-1-3"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1-1": {
      "type": "subtask",
      "title": "Define ToolResponse dataclass with success, data, error fields",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Create @dataclass ToolResponse with: success: bool, data: Dict[str, Any], error: Optional[str]",
        "started_at": "2025-11-26T19:29:01.821079Z",
        "status_note": "Starting ToolResponse dataclass implementation",
        "completed_at": "2025-11-26T19:29:32.333113Z",
        "needs_journaling": false,
        "actual_hours": 0.008,
        "journaled_at": "2025-11-26T19:29:32.335663Z"
      }
    },
    "task-1-1-2": {
      "type": "subtask",
      "title": "Create success_response() helper function",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Helper that wraps data in standard success format: {success: true, ...data, error: null}",
        "started_at": "2025-11-26T19:30:03.530099Z",
        "status_note": "Adding success_response helper function",
        "completed_at": "2025-11-26T19:30:25.913388Z",
        "needs_journaling": false,
        "actual_hours": 0.006,
        "journaled_at": "2025-11-26T19:30:25.918497Z"
      }
    },
    "task-1-1-3": {
      "type": "subtask",
      "title": "Create error_response() helper function",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Helper that creates standard error format: {success: false, error: message}",
        "started_at": "2025-11-26T19:30:56.371424Z",
        "status_note": "Adding error_response helper function",
        "completed_at": "2025-11-26T19:31:17.401448Z",
        "needs_journaling": false,
        "actual_hours": 0.006,
        "journaled_at": "2025-11-26T19:31:17.404291Z"
      }
    },
    "task-1-1-4": {
      "type": "subtask",
      "title": "Document meta/warnings contract",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Describe optional meta payload (version, pagination, warnings) and how multi-payload tools map fields into data/meta.",
        "started_at": "2025-11-26T19:31:46.317876Z",
        "status_note": "Documenting meta/warnings contract in responses.py",
        "completed_at": "2025-11-26T19:32:15.983273Z",
        "needs_journaling": false,
        "actual_hours": 0.008,
        "journaled_at": "2025-11-26T19:32:15.986006Z"
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "src/foundry_mcp/core/__init__.py",
      "status": "completed",
      "parent": "phase-1-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-1-1"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "file_path": "src/foundry_mcp/core/__init__.py",
        "task_category": "implementation",
        "estimated_hours": 0.25,
        "changes": "Export response utilities from core module",
        "started_at": "2025-11-26T19:32:49.967766Z",
        "status_note": "Adding response exports to core/__init__.py",
        "completed_at": "2025-11-26T19:33:14.938189Z",
        "needs_journaling": false,
        "actual_hours": 0.007,
        "journaled_at": "2025-11-26T19:33:14.941100Z"
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "Document response contract in responses.py docstrings",
      "status": "completed",
      "parent": "phase-1-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-1-1"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "file_path": "src/foundry_mcp/core/responses.py",
        "task_category": "implementation",
        "estimated_hours": 0.25,
        "changes": "Add module and function docstrings explaining the standard contract",
        "started_at": "2025-11-26T19:33:45.082980Z",
        "status_note": "Reviewing existing documentation, adding any missing docstrings",
        "completed_at": "2025-11-26T19:34:03.970127Z",
        "needs_journaling": false,
        "actual_hours": 0.005,
        "journaled_at": "2025-11-26T19:34:03.973203Z"
      }
    },
    "phase-1-verify": {
      "type": "group",
      "title": "Verification",
      "status": "completed",
      "parent": "phase-1",
      "children": [
        "verify-1-1",
        "verify-1-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-1-files"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 2,
      "completed_tasks": 2,
      "metadata": {
        "needs_journaling": false,
        "completed_at": "2025-11-26T19:35:38.249434Z",
        "journaled_at": "2025-11-26T19:35:38.254060Z"
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Response utilities are importable",
      "status": "completed",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "verification_type": "auto",
        "command": "python -c \"from foundry_mcp.core.responses import success_response, error_response\"",
        "expected": "No import errors",
        "started_at": "2025-11-26T19:34:32.467151Z",
        "status_note": "Running import verification",
        "completed_at": "2025-11-26T19:34:53.652654Z",
        "needs_journaling": false,
        "actual_hours": 0.006,
        "journaled_at": "2025-11-26T19:34:53.655842Z"
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "Response helpers produce correct format",
      "status": "completed",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "python -c \"from foundry_mcp.core.responses import success_response, error_response; ok = success_response({'foo': 'bar'}); assert ok['success'] and ok['error'] is None and ok['meta']['version'] == 'response-v2'; err = error_response('boom'); assert err['success'] is False and err['data'] == {} and err['error'] == 'boom'\"",
        "expected": "Helpers always emit success/data/error/meta keys",
        "started_at": "2025-11-26T19:35:18.261920Z",
        "status_note": "Running format verification with actual ToolResponse dataclass",
        "completed_at": "2025-11-26T19:35:38.249295Z",
        "needs_journaling": false,
        "actual_hours": 0.006,
        "journaled_at": "2025-11-26T19:35:38.251970Z"
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Fix Critical Inconsistencies (Tasks & Queries)",
      "status": "in_progress",
      "parent": "spec-root",
      "children": [
        "phase-2-files",
        "phase-2-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-1"
        ],
        "depends": [],
        "blocks": [
          "phase-3"
        ]
      },
      "total_tasks": 11,
      "completed_tasks": 6,
      "metadata": {
        "purpose": "Address the most broken modules first - tasks.py and queries.py have the worst inconsistencies",
        "risk_level": "medium",
        "estimated_hours": 4
      }
    },
    "phase-2-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "in_progress",
      "parent": "phase-2",
      "children": [
        "task-2-1",
        "task-2-2"
      ],
      "total_tasks": 9,
      "completed_tasks": 6,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-2-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "src/foundry_mcp/tools/tasks.py",
      "status": "completed",
      "parent": "phase-2-files",
      "children": [
        "task-2-1-1",
        "task-2-1-2",
        "task-2-1-3",
        "task-2-1-4",
        "task-2-1-5",
        "task-2-1-6"
      ],
      "total_tasks": 6,
      "completed_tasks": 6,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/tasks.py",
        "task_category": "refactoring",
        "estimated_hours": 2,
        "changes": "Standardize all 6 inconsistent tools to use success_response/error_response",
        "reasoning": "Tasks module has the most critical inconsistencies: found vs success, missing success fields"
      }
    },
    "task-2-1-1": {
      "type": "subtask",
      "title": "Fix foundry_next_task: replace 'found' with 'success'",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Change response from {found: bool, ...} to success_response({found: bool, ...})",
        "started_at": "2025-11-26T19:36:04.260991Z",
        "status_note": "Updating foundry_next_task to use standard response format",
        "completed_at": "2025-11-26T19:36:39.571688Z",
        "needs_journaling": false,
        "actual_hours": 0.01,
        "journaled_at": "2025-11-26T19:36:39.574756Z"
      }
    },
    "task-2-1-2": {
      "type": "subtask",
      "title": "Fix foundry_task_info: add success field wrapper",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Wrap response in success_response(), use error_response() for errors",
        "started_at": "2025-11-26T19:37:11.631746Z",
        "status_note": "Updating foundry_task_info to use standard response format",
        "completed_at": "2025-11-26T19:37:40.981528Z",
        "needs_journaling": false,
        "actual_hours": 0.008,
        "journaled_at": "2025-11-26T19:37:40.984257Z"
      }
    },
    "task-2-1-3": {
      "type": "subtask",
      "title": "Fix foundry_check_deps: add success field wrapper",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Wrap response in success_response(), use error_response() for errors",
        "started_at": "2025-11-26T19:38:12.717431Z",
        "status_note": "Updating foundry_check_deps to use standard response format",
        "completed_at": "2025-11-26T19:38:37.279102Z",
        "needs_journaling": false,
        "actual_hours": 0.007,
        "journaled_at": "2025-11-26T19:38:37.287800Z"
      }
    },
    "task-2-1-4": {
      "type": "subtask",
      "title": "Fix foundry_progress: add success field wrapper",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Wrap response in success_response(), use error_response() for errors",
        "started_at": "2025-11-26T19:39:08.756697Z",
        "status_note": "Updating foundry_progress to use standard response format",
        "completed_at": "2025-11-26T19:39:35.266665Z",
        "needs_journaling": false,
        "actual_hours": 0.007,
        "journaled_at": "2025-11-26T19:39:35.271310Z"
      }
    },
    "task-2-1-5": {
      "type": "subtask",
      "title": "Fix foundry_prepare_task: standardize variable return",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Ensure core_prepare_task returns standard format or wrap its return",
        "started_at": "2025-11-26T19:40:12.967229Z",
        "status_note": "Checking foundry_prepare_task and core_prepare_task return format",
        "completed_at": "2025-11-26T19:41:02.962888Z",
        "needs_journaling": false,
        "actual_hours": 0.014,
        "journaled_at": "2025-11-26T19:41:02.966805Z"
      }
    },
    "task-2-1-6": {
      "type": "subtask",
      "title": "Define empty/partial payload mapping",
      "status": "completed",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Document how dependency checks, missing tasks, or multi-result queries map into success/data/error/meta without losing context.",
        "started_at": "2025-11-26T19:41:43.058044Z",
        "status_note": "Adding edge case documentation for empty/partial payloads",
        "completed_at": "2025-11-26T19:42:12.931690Z",
        "needs_journaling": false,
        "actual_hours": 0.008,
        "journaled_at": "2025-11-26T19:42:12.934371Z"
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "src/foundry_mcp/tools/queries.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-2-1",
        "task-2-2-2",
        "task-2-2-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/queries.py",
        "task_category": "refactoring",
        "estimated_hours": 1.5,
        "changes": "Standardize all 3 query tools to use success_response/error_response",
        "reasoning": "Query tools have no success indicator at all, rely on presence of error field"
      }
    },
    "task-2-2-1": {
      "type": "subtask",
      "title": "Fix foundry_find_specs: replace 'found' with 'success'",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Change from {found: bool, ...} to success_response({found: bool, ...})"
      }
    },
    "task-2-2-2": {
      "type": "subtask",
      "title": "Fix foundry_list_specs: add success field",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Wrap {specs: [...], count: int} in success_response()"
      }
    },
    "task-2-2-3": {
      "type": "subtask",
      "title": "Fix foundry_query_tasks: add success field",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Wrap {spec_id: str, tasks: [...], count: int} in success_response()"
      }
    },
    "phase-2-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "verify-2-1",
        "verify-2-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-2-files"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Task tools return standard format",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/integration/test_mcp_tools.py -k 'foundry_prepare_task or foundry_next_task or foundry_task_info or foundry_progress' -v",
        "expected": "Task tool responses expose success/data/error/meta envelope"
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "Query tools return standard format",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/integration/test_mcp_tools.py -k 'foundry_find_specs or foundry_list_specs or foundry_query_tasks' -v",
        "expected": "Query tools return success/data/error/meta per contract"
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Standardize Remaining Modules",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-3-files",
        "phase-3-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-2"
        ],
        "depends": [],
        "blocks": [
          "phase-4"
        ]
      },
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Update tools that are mostly consistent but need alignment - remove schema_version, align response structures",
        "risk_level": "low",
        "estimated_hours": 3
      }
    },
    "phase-3-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "task-3-1",
        "task-3-2",
        "task-3-3",
        "task-3-4",
        "task-3-5"
      ],
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-3-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "src/foundry_mcp/tools/docs.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/docs.py",
        "task_category": "refactoring",
        "estimated_hours": 0.75,
        "changes": "Remove schema_version field, use success_response wrapper, normalize impact_analysis and docs_stats dual responses"
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "src/foundry_mcp/tools/testing.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/testing.py",
        "task_category": "refactoring",
        "estimated_hours": 0.75,
        "changes": "Remove schema_version field, use success_response wrapper for all 4 testing tools"
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "src/foundry_mcp/tools/journal.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/journal.py",
        "task_category": "refactoring",
        "estimated_hours": 0.5,
        "changes": "Minor alignment - already consistent, just switch to using imported helpers"
      }
    },
    "task-3-4": {
      "type": "task",
      "title": "src/foundry_mcp/tools/validation.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/foundry_mcp/tools/validation.py",
        "task_category": "refactoring",
        "estimated_hours": 0.5,
        "changes": "Minor alignment - already consistent, switch to using imported helpers"
      }
    },
    "task-3-5": {
      "type": "task",
      "title": "Client compatibility + telemetry rollout",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "estimated_hours": 0.75,
        "file_path": "src/foundry_mcp/server.py",
        "changes": "Wire response_contract_v2 flag, capability negotiation, and telemetry counters so schema_version removal is coordinated."
      }
    },
    "phase-3-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "verify-3-1",
        "verify-3-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-3-files"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Docs and testing tools return standard format",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/integration/test_mcp_tools.py -k 'docs or testing' -v",
        "expected": "Docs and testing tools emit response-v2 envelope"
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "Journal and validation tools return standard format",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/integration/test_mcp_tools.py -k 'journal or validation' -v",
        "expected": "Journal and validation tools emit response-v2 envelope"
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Testing & Final Verification",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-4-files",
        "phase-4-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-3"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Ensure all changes work correctly, update tests to validate standard format, run full test suite",
        "risk_level": "low",
        "estimated_hours": 3
      }
    },
    "phase-4-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-1",
        "task-4-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-4-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "tests/test_responses.py",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/test_responses.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Create tests for response helper functions and standard format validation"
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Update existing tool tests for new response format",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "refactoring",
        "estimated_hours": 1.5,
        "changes": "Update test assertions across all tool test files to expect standard response format",
        "file_path": "task-4-2.md"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-4-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "verify-4-1",
        "verify-4-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-4-files"
        ],
        "depends": [],
        "blocks": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-4-1": {
      "type": "verify",
      "title": "Full test suite passes",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest -v",
        "expected": "All tests pass"
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "Implementation fidelity review",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "spec",
        "target": "spec-root",
        "on_failure": {
          "consult": true,
          "revert_status": "in_progress",
          "continue_on_failure": false
        }
      }
    }
  },
  "journal": [
    {
      "timestamp": "2025-11-26T19:29:32.335659Z",
      "entry_type": "status_change",
      "title": "Task Completed: Define ToolResponse dataclass with success, data, error fields",
      "author": "claude-code",
      "content": "Created src/foundry_mcp/core/responses.py with ToolResponse dataclass containing success (bool), data (Dict[str, Any]), and error (Optional[str]) fields. Used field(default_factory=dict) for mutable default. Follows existing codebase patterns from validation.py dataclasses.",
      "metadata": {},
      "task_id": "task-1-1-1"
    },
    {
      "timestamp": "2025-11-26T19:30:25.918489Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create success_response() helper function",
      "author": "claude-code",
      "content": "Added success_response(**data) helper function that accepts keyword arguments and wraps them in a ToolResponse with success=True. Includes docstring with example usage.",
      "metadata": {},
      "task_id": "task-1-1-2"
    },
    {
      "timestamp": "2025-11-26T19:31:17.404284Z",
      "entry_type": "status_change",
      "title": "Task Completed: Create error_response() helper function",
      "author": "claude-code",
      "content": "Added error_response(message) helper function that creates ToolResponse with success=False and the provided error message. Includes docstring with example usage.",
      "metadata": {},
      "task_id": "task-1-1-3"
    },
    {
      "timestamp": "2025-11-26T19:32:15.986001Z",
      "entry_type": "status_change",
      "title": "Task Completed: Document meta/warnings contract",
      "author": "claude-code",
      "content": "Added comprehensive module docstring documenting: (1) base response schema contract (success/data/error), (2) meta payload convention with _meta reserved key for version, pagination, and timing, (3) _warnings reserved key for non-fatal issues, (4) multi-payload tools convention for nesting multiple payloads under named keys.",
      "metadata": {},
      "task_id": "task-1-1-4"
    },
    {
      "timestamp": "2025-11-26T19:33:14.941089Z",
      "entry_type": "status_change",
      "title": "Task Completed: src/foundry_mcp/core/__init__.py",
      "author": "claude-code",
      "content": "Added imports and exports for ToolResponse, success_response, and error_response from foundry_mcp.core.responses to core/__init__.py. These are now accessible via `from foundry_mcp.core import ToolResponse, success_response, error_response`.",
      "metadata": {},
      "task_id": "task-1-2"
    },
    {
      "timestamp": "2025-11-26T19:34:03.973194Z",
      "entry_type": "status_change",
      "title": "Task Completed: Document response contract in responses.py docstrings",
      "author": "claude-code",
      "content": "Verified documentation is already comprehensive from task-1-1-4 work. Module docstring covers: (1) Response Schema Contract with JSON structure, (2) Meta Payload Convention with _meta and _warnings reserved keys, (3) Multi-Payload Tools section. All functions (success_response, error_response) and ToolResponse dataclass have complete docstrings with Args, Returns, and Example sections.",
      "metadata": {},
      "task_id": "task-1-3"
    },
    {
      "timestamp": "2025-11-26T19:34:03.975798Z",
      "entry_type": "status_change",
      "title": "Group Completed: File Modifications",
      "author": "claude-code",
      "content": "All child tasks in group phase-1-files have been completed.",
      "metadata": {},
      "task_id": "phase-1-files"
    },
    {
      "timestamp": "2025-11-26T19:34:53.655834Z",
      "entry_type": "status_change",
      "title": "Task Completed: Response utilities are importable",
      "author": "claude-code",
      "content": "Import verification passed. Tested both direct import (`from foundry_mcp.core.responses import success_response, error_response`) and core module export (`from foundry_mcp.core import ToolResponse, success_response, error_response`). Both imports successful with no errors.",
      "metadata": {},
      "task_id": "verify-1-1"
    },
    {
      "timestamp": "2025-11-26T19:35:38.251965Z",
      "entry_type": "status_change",
      "title": "Task Completed: Response helpers produce correct format",
      "author": "claude-code",
      "content": "Format verification passed. Tested: (1) success_response(foo='bar', count=5) returns ToolResponse with success=True, error=None, data={'foo': 'bar', 'count': 5}, (2) error_response('boom') returns ToolResponse with success=False, data={}, error='boom', (3) Direct ToolResponse instantiation works correctly. All assertions passed.",
      "metadata": {},
      "task_id": "verify-1-2"
    },
    {
      "timestamp": "2025-11-26T19:35:38.254057Z",
      "entry_type": "status_change",
      "title": "Group Completed: Verification",
      "author": "claude-code",
      "content": "All child tasks in group phase-1-verify have been completed.",
      "metadata": {},
      "task_id": "phase-1-verify"
    },
    {
      "timestamp": "2025-11-26T19:35:38.255062Z",
      "entry_type": "status_change",
      "title": "Phase Completed: Define Standard Response Contract",
      "author": "claude-code",
      "content": "All child tasks in phase phase-1 have been completed.",
      "metadata": {},
      "task_id": "phase-1"
    },
    {
      "timestamp": "2025-11-26T19:36:39.574749Z",
      "entry_type": "status_change",
      "title": "Task Completed: Fix foundry_next_task: replace 'found' with 'success'",
      "author": "claude-code",
      "content": "Updated foundry_next_task in tasks.py to use standard response schema. All returns now follow {success: bool, data: {...}, error: str|null} format. The 'found' field is now nested inside data for successful operations. Error cases return success=False with empty data dict.",
      "metadata": {},
      "task_id": "task-2-1-1"
    },
    {
      "timestamp": "2025-11-26T19:37:40.984249Z",
      "entry_type": "status_change",
      "title": "Task Completed: Fix foundry_task_info: add success field wrapper",
      "author": "claude-code",
      "content": "Updated foundry_task_info in tasks.py to use standard response schema. All returns now follow {success: bool, data: {...}, error: str|null} format. Error cases return success=False with empty data dict. Success case wraps all task data inside data field.",
      "metadata": {},
      "task_id": "task-2-1-2"
    },
    {
      "timestamp": "2025-11-26T19:38:37.287789Z",
      "entry_type": "status_change",
      "title": "Task Completed: Fix foundry_check_deps: add success field wrapper",
      "author": "claude-code",
      "content": "Updated foundry_check_deps in tasks.py to use standard response schema. All returns now follow {success: bool, data: {...}, error: str|null} format. The deps object from check_dependencies is now wrapped inside data field. Error cases return success=False with empty data dict.",
      "metadata": {},
      "task_id": "task-2-1-3"
    },
    {
      "timestamp": "2025-11-26T19:39:35.271303Z",
      "entry_type": "status_change",
      "title": "Task Completed: Fix foundry_progress: add success field wrapper",
      "author": "claude-code",
      "content": "Updated foundry_progress in tasks.py to use standard response schema. All returns now follow {success: bool, data: {...}, error: str|null} format. The progress object from get_progress_summary is now wrapped inside data field. Error cases return success=False with empty data dict.",
      "metadata": {},
      "task_id": "task-2-1-4"
    },
    {
      "timestamp": "2025-11-26T19:41:02.966800Z",
      "entry_type": "status_change",
      "title": "Task Completed: Fix foundry_prepare_task: standardize variable return",
      "author": "claude-code",
      "content": "Updated both core_prepare_task in core/task.py and foundry_prepare_task in tools/tasks.py to use standard response schema. core_prepare_task now returns {success: bool, data: {...}, error: str|null} with all task data nested inside data field. Error cases return success=False with empty data dict. The wrapper function error cases also updated to include data: {} field.",
      "metadata": {},
      "task_id": "task-2-1-5"
    },
    {
      "timestamp": "2025-11-26T19:42:12.934366Z",
      "entry_type": "status_change",
      "title": "Task Completed: Define empty/partial payload mapping",
      "author": "claude-code",
      "content": "Added comprehensive \"Edge Cases & Partial Payloads\" documentation section to responses.py module docstring. Covers: (1) Empty Results with success=True, (2) Not Found errors with success=False, (3) Blocked/Conditional states with success=True and state info in data, (4) Partial Success with _warnings. Documents key principle that success=True means operation executed (even if empty result), success=False means operation failed.",
      "metadata": {},
      "task_id": "task-2-1-6"
    }
  ]
}